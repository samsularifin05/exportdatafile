var J=["EXCEL","PDF","TXT","ALL"];function F(s,f=!1){let u=new Date(s),o=new Date(u.getTime()+7*60*60*1e3),n=o.getUTCFullYear(),p=String(o.getUTCMonth()+1).padStart(2,"0"),g=String(o.getUTCDate()).padStart(2,"0"),m=String(o.getUTCHours()).padStart(2,"0"),l=String(o.getUTCMinutes()).padStart(2,"0"),w=String(o.getUTCSeconds()).padStart(2,"0");return f?`${g}-${p}-${n} ${m}:${l}:${w}`:`${g}-${p}-${n}`}function W(s){return s.every(f=>J.includes(f))}function D(s){let f=0;return s.forEach(u=>{u.child&&u.child.length>0?f+=D(u.child):f+=1}),f}var A=s=>{let f=[];return s.forEach(u=>{u.child&&u.child.length>0?f.push(...A(u.child)):f.push(u)}),f},U=s=>s.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");async function S(s,f,u,o){for(let n=0;n<o.length;n++){let p=o[n];if(p?.isImage&&p?.imageSrc&&typeof p.imageSrc=="string"&&p.imageSrc.startsWith("data:image"))try{let{buffer:g,extension:m}=K(p.imageSrc),l=s.addImage({buffer:g,extension:m});f.addImage(l,{tl:{col:n,row:u.number-1},ext:{width:70,height:60},editAs:"oneCell"}),(!u.height||u.height<60)&&(u.height=35)}catch(g){console.error("\u274C Error adding image to row:",g),u.getCell(n+1).value="[Image]"}}}function K(s){let f=s.match(/^data:image\/(\w+);base64,(.*)$/);if(!f)throw new Error("Invalid base64 image format");let u=f[1]==="jpg"?"jpeg":f[1],o=f[2],n=atob(o),p=n.length,g=new Uint8Array(p);for(let m=0;m<p;m++)g[m]=n.charCodeAt(m);return{buffer:g,extension:u}}import q from"exceljs";var Q=async({columns:s,data:f,grouping:u,date:o,excelSetting:n,title:p,footerSetting:g})=>{let m=new q.Workbook;s=s.filter(a=>!a.options?.disabledColumn);let l=m.addWorksheet(p||n?.titleExcel),w=D(s),x=l.addRow([]);x.getCell(1).value=p||n?.titleExcel,x.getCell(1).alignment={horizontal:"center"};let P=l.getColumn(w).letter;if(l.mergeCells(`A${x.number}:${P}${x.number}`),x.eachCell(a=>{a.font={color:{argb:"000000"},bold:!0,size:12}}),o){let a=l.addRow([]);a.getCell(1).value=`${o.caption?o.caption:"Tanggal "} : ${o?.start_date} ${o?.end_date?`s/d ${o?.end_date}`:""}`,a.getCell(1).alignment={horizontal:"center"},l.mergeCells(`A${a.number}:${P}${a.number}`),a.eachCell(i=>{i.font={color:{argb:"00000"},bold:!0,size:12}})}let v=l.addRow([]);v.getCell(1).value=n?.additionalTextHeader||"",v.getCell(1).alignment={horizontal:"center"},l.mergeCells(`A${v.number}:${P}${v.number}`),v.eachCell(a=>{a.font={color:{argb:"000000"},bold:!0,size:12}}),n?.customHeader&&n.customHeader(l,w);let N=n?.startY&&n.startY>0?n.startY:1;if(N>1)for(let a=1;a<N;a++)l.addRow([]);let z=s.some(a=>a.child&&a.child.length>0),T=l.addRow([]),h=z?l.addRow([]):null;s.forEach(a=>{if(a.child&&a.child.length>0){let i=T.actualCellCount+1,b=a.child.length;T.getCell(i).value=a.label,b>1&&l.mergeCells(T.number,i,T.number,i+b-1);for(let t=i;t<i+b;t++){let e=T.getCell(t);e.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},e.font={color:{argb:n?.txtColor||"000000"},bold:!0},e.alignment={horizontal:"center",vertical:"middle"}}a.child.forEach((t,e)=>{if(h){let c=h.getCell(i+e);c.value=t.label,c.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},c.font={color:{argb:n?.txtColor||"000000"},bold:!0};let C=t.options?.halign||(["RP","GR","NUMBER"].includes(t?.options?.format||"")?"right":"left"),d=t.options?.valign||"middle";c.alignment={horizontal:C,vertical:d}}})}else{let i=T.actualCellCount+1;T.getCell(i).value=a.label,T.getCell(i).fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},T.getCell(i).font={color:{argb:n?.txtColor||"000000"},bold:!0},T.getCell(i).alignment={horizontal:a.options?.halign||"center",vertical:a.options?.valign||"middle"},z&&h&&l.mergeCells(T.number,i,h.number,i)}});let G={};f.forEach(async a=>{if(a.detail?.length>0){if(u.length>0){let t=D(s),e=u.map(C=>a[C]!==void 0||a[C]!==null?`${U(C)} : ${a[C]}`:"").filter(Boolean).join("  |  "),c=l.addRow([e]);l.mergeCells(`A${c.number}:${String.fromCharCode(64+t)}${c.number}`),c.getCell(1).alignment={horizontal:"left"},c.getCell(1).font={bold:!0}}let i={};a.detail.forEach(async t=>{let c=A(s).map(d=>{if(d?.options?.format==="IMAGE"&&t[d.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:t[d.key]};let I=d?.options?.format==="DATETIME"?F(t[d.key],!0):d?.options?.format==="DATE"?F(t[d.key]):t[d.key],k={horizontal:d?.options?.halign?d?.options?.halign:d?.options?.format==="RP"||d?.options?.format==="GR"||d?.options?.format==="NUMBER"?"right":"left"},$=d.key;return G[$]=(G[$]||0)+Number(I),i[$]=(i[$]||0)+Number(I),{value:I,alignment:k,numFmt:d?.options?.format==="RP"?"#,##0":d?.options?.format==="GR"?"#,##0.000":void 0}}),C=l.addRow(c.map(d=>d.value));c.forEach((d,I)=>{let k=C.getCell(I+1),$=["center","right","left","fill","justify","centerContinuous","distributed"],B=["top","middle","bottom","distributed","justify"],_,H;d.alignment&&typeof d.alignment.horizontal=="string"&&$.includes(d.alignment.horizontal)&&(_=d.alignment.horizontal),d.alignment&&"vertical"in d.alignment&&typeof d.alignment.vertical=="string"&&B.includes(d.alignment.vertical)&&(H=d.alignment.vertical),k.alignment={..._?{horizontal:_}:{},...H?{vertical:H}:{}},d.numFmt&&typeof d.value=="number"&&!isNaN(d.value)&&(k.value=Number(d.value),k.numFmt=d.numFmt)}),await S(m,l,C,c)});let b=A(s);if(!g?.subTotal?.disableSubtotal){let t=l.addRow(s.map(()=>null));b.forEach((e,c)=>{if(e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"){let d=f.length+4-1,I=`SUM(${String.fromCharCode(65+c)}4:${String.fromCharCode(65+c)}${d})`,k=t.getCell(c+1),$=g?.subTotal?.enableCount&&u.length>0?" : "+a.detail.length:"",B=g?.subTotal?.captionItem?g?.subTotal?.captionItem:"";t.getCell(1).value=`${g?.subTotal?.caption||"SUB TOTAL"} ${$} ${B}`,t.getCell(1).alignment={horizontal:"center"},k.numFmt=e?.options?.format==="GR"?"#,##0.000":"#,##0",k.value={formula:I},t.getCell(c+1).value=e?.options.disabledFooter?"":i[e.key]}else t.getCell(c+1).value=""}),n?.grandTotalSetting?.colSpan&&l.mergeCells(`A${t.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${t.number}`),t.eachCell(e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},e.font={color:{argb:n?.txtColor},bold:!0}})}}else{let b=A(s).map(e=>{if(e?.options?.format==="IMAGE"&&a[e.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:a[e.key]};let c=e?.options?.format==="DATETIME"?F(a[e.key]):e?.options?.format==="DATE"?F(a[e.key]):a[e.key],C={horizontal:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"?"right":"left"},d=e.key;return G[d]=(G[d]||0)+Number(c),{value:c,alignment:C,numFmt:e?.options?.format==="RP"?"#,##0":e?.options?.format==="GR"?"#,##0.000":void 0}}),t=l.addRow(b.map(e=>e.value));b.forEach((e,c)=>{let C=t.getCell(c+1),d=["center","right","left","fill","justify","centerContinuous","distributed"],I=["top","middle","bottom","distributed","justify"],k,$;e.alignment&&typeof e.alignment.horizontal=="string"&&d.includes(e.alignment.horizontal)&&(k=e.alignment.horizontal),e.alignment&&"vertical"in e.alignment&&typeof e.alignment.vertical=="string"&&I.includes(e.alignment.vertical)&&($=e.alignment.vertical),C.alignment={...k?{horizontal:k}:{},...$?{vertical:$}:{}},e.numFmt&&typeof e.value=="number"&&!isNaN(e.value)&&(C.value=Number(e.value),C.numFmt=e.numFmt)}),await S(m,l,t,b)}});let R=l.addRow(s.map(()=>null)),j=A(s);g?.grandTotal?.disableGrandTotal||(j.forEach((a,i)=>{if(a?.options?.format==="RP"||a?.options?.format==="GR"||a?.options?.format==="NUMBER"){let t=f.length+4-1,e=`SUM(${String.fromCharCode(65+i)}4:${String.fromCharCode(65+i)}${t})`,c=R.getCell(i+1),C=g?.grandTotal?.enableCount?u.length>0?" : "+f.map(k=>k.detail.length).reduce((k,$)=>k+$,0):" : "+f.length:"",d=g?.grandTotal?.captionItem?g?.grandTotal?.captionItem:"",I=`${g?.grandTotal?.caption||"GRAND TOTAL"} ${C} ${d}`;R.getCell(1).value=I,R.getCell(1).alignment={horizontal:"center"},c.numFmt=a?.options?.format==="GR"?"#,##0.000":"#,##0",c.value={formula:e},R.getCell(i+1).value=a?.options.disabledFooter?"":G[a.key]}else R.getCell(i+1).value=""}),n?.grandTotalSetting?.colSpan&&l.mergeCells(`A${R.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${R.number}`),R.eachCell(a=>{a.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},a.font={color:{argb:n?.txtColor},bold:!0}})),n?.customFooter&&n.customFooter(l,w);let r=await m.xlsx.writeBuffer(),y=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),E=document.createElement("a");E.href=URL.createObjectURL(y),E.download=`${n?.titleExcel||p}.xlsx`,document.body.appendChild(E),E.click(),document.body.removeChild(E)},O=Q;import Z from"jspdf";import Y from"jspdf-autotable";var tt=({columns:s,data:f,grouping:u,pdfSetting:o,date:n,title:p,footerSetting:g})=>{let m=new Z(o?.orientation,o?.unit,[o?.width||297,o?.height||210]),l=[],w=n?30:20;s=s.filter(r=>!r.options?.disabledColumn),m.setFontSize(10);let x=m.internal.pageSize.getWidth(),P=m.splitTextToSize(o?.textHeaderLeft||"",110);m.text(P,15,18),m.text(`${p||o?.titlePdf}`,x-15,18,{align:"right"}),n&&m.text(`${n.caption?n.caption:"TANGGAL "} : ${n?.start_date} ${n?.end_date?`s/d ${n?.end_date}`:""}`,x-15,22,{align:"right"}),typeof o?.customHeader=="function"&&o.customHeader(m,w,Y),m.setProperties({title:p||o?.titlePdf}),o?.startY&&(w=o.startY);let v=[],N=[],z=s.some(r=>r.child&&r.child.length>0);s.forEach(r=>{let y={textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",...r?.options?.valign?{valign:r.options.valign}:{},halign:r?.options?.halign??(["RP","GR","NUMBER"].includes(r?.options?.format||"")?"right":"left")};z?r.child&&r.child.length>0?(v.push({content:r.label,colSpan:r.child.length,styles:y}),r.child.forEach(E=>{N.push({content:E.label,key:E.key,options:E.options,styles:{...y,halign:E?.options?.halign??(["RP","GR","NUMBER"].includes(E?.options?.format||"")?"right":"left")}})})):v.push({content:r.label,rowSpan:2,key:r.key,options:r.options,styles:y}):v.push({content:r.label,key:r.key,options:r.options,styles:y})}),l.push(v),z&&N.length>0&&l.push(N);let T={};f.forEach(r=>{if(r.detail?.length>0){if(u.length>0){let a=D(s),b=[{content:u.map(t=>r[t]!==void 0||r[t]!==null?`${U(t)} : ${r[t]}`:"").filter(Boolean).join("  |  "),colSpan:a,styles:{fontStyle:"bold",halign:"left"}}];l.push(b)}let y={},E=A(s);if(r.detail.forEach(a=>{let i=E.map(b=>{let t=a[b.key],e=b.key;T[e]=(T[e]||0)+Number(t||0),y[e]=(y[e]||0)+Number(t||0);let c=b.options?.format==="IMAGE";return{content:(()=>{switch(b?.options?.format){case"RP":return t!==void 0?Number(t||0).toLocaleString("kr-ko"):"";case"GR":return t!==void 0?Number(t||0).toFixed(3):"";case"NUMBER":return t!==void 0?Number(t||0):"";case"IMAGE":return"";case"DATETIME":return t!==void 0?F(t||new Date,!0):"";case"DATE":return t!==void 0?F(t||new Date):"";default:return t!==void 0?t.toString():""}})(),foto:c?t:null,styles:{halign:b?.options?.halign?b?.options?.halign:b?.options?.format==="RP"||b?.options?.format==="GR"||b?.options?.format==="NUMBER"||typeof t=="number"?"right":"left"}}});l.push(i)}),!g?.subTotal?.disableSubtotal){let a=[];E.forEach(e=>{let c=y[e.key];e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"?a.push({content:e?.options?.disabledFooter?"":(()=>{switch(e?.options?.format){case"RP":return c.toLocaleString("kr-ko");case"GR":return c.toFixed(3);case"NUMBER":return c;default:return c.toString()}})(),styles:{halign:e?.options?.halign||"right",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}}):a.push({content:"",styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let i=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0,b=g?.subTotal?.enableCount&&u.length>0?" : "+r.detail.length:"",t=g?.subTotal?.captionItem?g?.subTotal?.captionItem:"";a[0]={content:`${g?.subTotal?.caption||"SUB TOTAL"}${b} ${t}`,colSpan:i,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&a.splice(1,o?.grandTotalSetting?.colSpan),l.push(a)}}else{let y=(i,b)=>{let t=b[i.key],e=i.key;i.options?.disabledFooter||(T[e]=(T[e]||0)+Number(t||0));let c=(()=>{switch(i?.options?.format){case"RP":return t!==void 0?Number(t||0).toLocaleString("kr-ko"):"";case"GR":return t!==void 0?Number(t||0).toFixed(3):"";case"NUMBER":return t!==void 0?Number(t||0):"";case"IMAGE":return"";case"DATETIME":return t!==void 0?F(t||new Date,!0):"";case"DATE":return t!==void 0?F(t||new Date):"";default:return t!==void 0?t?.toString():""}})(),C=i?.options?.halign?i?.options?.halign:i?.options?.format==="RP"||i?.options?.format==="GR"||i?.options?.format==="NUMBER"||typeof t=="number"?"right":"left",d=i.options?.format==="IMAGE";return{options:i?.options,content:c,foto:d?t:null,styles:{halign:C}}},a=A(s).map(i=>y(i,r));l.push(a)}});let h=A(s);if(!g?.grandTotal?.disableGrandTotal){let r=[];h.forEach(t=>{let e=T[t.key],c=["RP","GR","NUMBER"].includes(t?.options?.format||""),C=t?.options?.disabledFooter?"":(()=>{if(!c)return"";switch(t.options?.format){case"RP":return Number(e||0).toLocaleString("kr-KO");case"GR":return Number(e||0).toFixed(3);case"NUMBER":return Number(e||0);default:return(e||0).toString()}})();r.push({options:t?.options,content:C,styles:{halign:t?.options?.halign?t.options.halign:c?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let y=Number(o?.grandTotalSetting?.colSpan||0),E=Math.min(y+1,h.length),a=g?.grandTotal?.enableCount?u.length>0?f.reduce((t,e)=>t+e.detail.length,0):f.length:0,i=g?.grandTotal?.captionItem||"",b=`${g?.grandTotal?.caption||"GRAND TOTAL"}`+(a?` : ${a}`:"")+(i?` ${i}`:"");for(r[0]={content:b,colSpan:E,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},r.splice(1,E-1);r.length<h.length;)r.push({content:"",styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}});l.push(r)}if(typeof o?.addRow=="function"&&o?.addRow(l),!o?.disablePrintDate){let r=D(s);l.push([{content:`Print Date : ${F(`${new Date}`)}`,colSpan:r,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}])}Y(m,{head:[],body:l,startY:w,theme:o?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:o?.fontSIze||8},headStyles:{fontSize:o?.fontSIze||8,textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255],didParseCell:function(r){let y=r.column.index;h[y]?.options?.format==="IMAGE"&&r.cell.raw&&r.cell.raw.foto&&(r.row.height=20,r.cell.styles.valign="middle",r.cell.styles.halign="center")},didDrawCell:function(r){let{cell:y}=r,a=(y.raw||{}).foto,i=r.column.index;if(h[i]?.options?.format==="IMAGE"&&a){let e=y.x+(y.width-15)/2,c=y.y+(y.height-15)/2;try{m.addImage(a,"JPG",e,c,15,15)}catch(C){console.warn("\u274C Gagal render gambar:",C)}}}}),l=[],w=m.lastAutoTable.finalY;let G=m.internal.getNumberOfPages(),R=m.internal.pageSize.width,j=m.internal.pageSize.height;m.setFontSize(10);for(let r=1;r<G+1;r++){let y=R/2,E=j-10;m.setPage(r),m.text(`${r} of ${G}`,y,E,{align:"center"})}if(typeof o?.customFooter=="function"&&o.customFooter(m,w,Y),o?.openNewTab){let r=m.output("bloburl");window.open(r)}else m.save(`${o?.titlePdf||p}.pdf`)},X=tt;var et=s=>{let f=[],u=s.copy?2:1;for(let o=0;o<u;o++){let n=s.data.map(p=>{let g=s.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(g);)g=g.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(m,l,w)=>{let x=w.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(p[l])?p[l]:[p[l]]).reduce((N,z)=>N+x.replace(/\{([a-z0-9_]+)\}/gm,T=>{let h=T.replace(/(\{|\})/g,"");if(h.match(/nama_barang/)){let G=h.match(/nama_barang/),R=h==="nama_barang2"?[20,40]:h==="nama_barang3"?[40,60]:[0,20];return z[G]?.slice(...R).trim()||""}if(h.match(/deskripsi_jual/)){let G=h.match(/deskripsi_jual/),R=h==="deskripsi_jual2"?[20,40]:h==="deskripsi_jual3"?[40,60]:[0,20];return z[G]?.slice(...R).trim()||""}if(h.match(/deskripsi/)){let G=h.match(/deskripsi/),R=h==="deskripsi2"?[20,40]:h==="deskripsi3"?[40,60]:[0,20];return z[G]?.slice(...R).trim()||""}return z[h]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return g.replace(/\{([a-z0-9_]+)\}/gm,m=>{let l=m.replace(/(\{|\})/g,"");return l.match(/auto_cut/)?`
VA`:p[l]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let p in n)n[p]+=`

`;f.push(...n)}return f},ot=async(s,f)=>{let u=et(s),o=new Blob([u?.join(`
`)||""],{type:"text/plain"}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download=f,document.body.appendChild(n),n.click(),document.body.removeChild(n)},V=ot;var Gt=({columns:s,data:f,grouping:u,date:o,type:n,txtSetting:p,pdfSetting:g,excelSetting:m,title:l,footerSetting:w})=>{let x={data:[p?.dataTxt],template:p?.templateTxt,copy:p?.copy};if(f.length===0)throw new Error("Data is required");if(n.length===0)throw new Error("Type is required");if(!W(n))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');n.forEach(P=>{P==="PDF"?X({pdfSetting:g,date:o,data:f,type:n,columns:s,grouping:u,title:l,footerSetting:w}):P==="TXT"?V(x,p?.titleTxt||""):P==="EXCEL"?O({date:o,data:f,type:n,columns:s,grouping:u,excelSetting:m,title:l,footerSetting:w}):(O({date:o,data:f,type:n,columns:s,grouping:u,excelSetting:m,title:l}),X({pdfSetting:g,date:o,data:f,type:n,columns:s,grouping:u,title:l}),V(x,p?.titleTxt||""))})};export{Gt as ExportData};
//# sourceMappingURL=index.mjs.map