var V=["EXCEL","PDF","TXT","ALL"];function N(d){let c=new Date(d),m=c.getFullYear(),e=String(c.getMonth()+1).padStart(2,"0"),n=String(c.getDate()).padStart(2,"0"),h=String(c.getHours()).padStart(2,"0"),p=String(c.getMinutes()).padStart(2,"0"),g=String(c.getSeconds()).padStart(2,"0");return`${n}-${e}-${m} ${h}:${p}:${g}`}function Y(d){return d.every(c=>V.includes(c))}function A(d){let c=0;return d.forEach(m=>{m.child&&m.child.length>0?c+=A(m.child):c+=1}),c}var z=d=>{let c=[];return d.forEach(m=>{m.child&&m.child.length>0?c.push(...z(m.child)):c.push(m)}),c},M=d=>d.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");async function _(d,c,m,e){for(let n=0;n<e.length;n++){let h=e[n];if(h?.isImage&&h?.imageSrc&&typeof h.imageSrc=="string"&&h.imageSrc.startsWith("data:image"))try{let{buffer:p,extension:g}=W(h.imageSrc),l=d.addImage({buffer:p,extension:g});c.addImage(l,{tl:{col:n,row:m.number-1},ext:{width:70,height:60},editAs:"oneCell"}),(!m.height||m.height<60)&&(m.height=35)}catch(p){console.error("\u274C Error adding image to row:",p),m.getCell(n+1).value="[Image]"}}}function W(d){let c=d.match(/^data:image\/(\w+);base64,(.*)$/);if(!c)throw new Error("Invalid base64 image format");let m=c[1]==="jpg"?"jpeg":c[1],e=c[2],n=atob(e),h=n.length,p=new Uint8Array(h);for(let g=0;g<h;g++)p[g]=n.charCodeAt(g);return{buffer:p,extension:m}}import K from"exceljs";var q=async({columns:d,data:c,grouping:m,date:e,excelSetting:n,title:h,footerSetting:p})=>{let g=new K.Workbook;d=d.filter(o=>!o.options?.disabledColumn);let l=g.addWorksheet(h||n?.titleExcel),$=A(d),k=l.addRow([]);k.getCell(1).value=h||n?.titleExcel,k.getCell(1).alignment={horizontal:"center"};let I=l.getColumn($).letter;if(l.mergeCells(`A${k.number}:${I}${k.number}`),k.eachCell(o=>{o.font={color:{argb:"000000"},bold:!0,size:12}}),e){let o=l.addRow([]);o.getCell(1).value=`${e.caption?e.caption:"Tanggal "} : ${e?.start_date} ${e?.end_date?`s/d ${e?.end_date}`:""}`,o.getCell(1).alignment={horizontal:"center"},l.mergeCells(`A${o.number}:${I}${o.number}`),o.eachCell(f=>{f.font={color:{argb:"00000"},bold:!0,size:12}})}let v=l.addRow([]);v.getCell(1).value=n?.additionalTextHeader||"",v.getCell(1).alignment={horizontal:"center"},l.mergeCells(`A${v.number}:${I}${v.number}`),v.eachCell(o=>{o.font={color:{argb:"000000"},bold:!0,size:12}});let P=d.some(o=>o.child&&o.child.length>0),E=l.addRow([]),G=P?l.addRow([]):null;d.forEach(o=>{if(o.child&&o.child.length>0){let f=E.actualCellCount+1,u=o.child.length;E.getCell(f).value=o.label,u>1&&l.mergeCells(E.number,f,E.number,f+u-1);for(let i=f;i<f+u;i++){let t=E.getCell(i);t.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},t.font={color:{argb:n?.txtColor||"000000"},bold:!0},t.alignment={horizontal:"center",vertical:"middle"}}o.child.forEach((i,t)=>{if(G){let r=G.getCell(f+t);r.value=i.label,r.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},r.font={color:{argb:n?.txtColor||"000000"},bold:!0};let b=i.options?.halign||(["RP","GR","NUMBER"].includes(i?.options?.format||"")?"right":"left"),s=i.options?.valign||"middle";r.alignment={horizontal:b,vertical:s}}})}else{let f=E.actualCellCount+1;E.getCell(f).value=o.label,E.getCell(f).fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},E.getCell(f).font={color:{argb:n?.txtColor||"000000"},bold:!0},E.getCell(f).alignment={horizontal:o.options?.halign||"center",vertical:o.options?.valign||"middle"},P&&G&&l.mergeCells(E.number,f,G.number,f)}});let C={};c.forEach(async o=>{if(o.detail.length>0){if(m.length>0){let i=A(d),t=m.map(b=>o[b]!==void 0||o[b]!==null?`${M(b)} : ${o[b]}`:"").filter(Boolean).join("  |  "),r=l.addRow([t]);l.mergeCells(`A${r.number}:${String.fromCharCode(64+i)}${r.number}`),r.getCell(1).alignment={horizontal:"left"},r.getCell(1).font={bold:!0}}let f={};o.detail.forEach(async i=>{let r=z(d).map(s=>{if(s?.options?.format==="IMAGE"&&i[s.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:i[s.key]};let x=s?.options?.format==="DATETIME"?N(i[s.key]):i[s.key],w={horizontal:s?.options?.halign?s?.options?.halign:s?.options?.format==="RP"||s?.options?.format==="GR"||s?.options?.format==="NUMBER"?"right":"left"},R=s.key;return C[R]=(C[R]||0)+Number(x),f[R]=(f[R]||0)+Number(x),{value:x,alignment:w,numFmt:s?.options?.format==="RP"?"#,##0":s?.options?.format==="GR"?"#,##0.000":void 0}}),b=l.addRow(r.map(s=>s.value));r.forEach((s,x)=>{let w=b.getCell(x+1),R=["center","right","left","fill","justify","centerContinuous","distributed"],j=["top","middle","bottom","distributed","justify"],B,S;s.alignment&&typeof s.alignment.horizontal=="string"&&R.includes(s.alignment.horizontal)&&(B=s.alignment.horizontal),s.alignment&&"vertical"in s.alignment&&typeof s.alignment.vertical=="string"&&j.includes(s.alignment.vertical)&&(S=s.alignment.vertical),w.alignment={...B?{horizontal:B}:{},...S?{vertical:S}:{}},s.numFmt&&typeof s.value=="number"&&!isNaN(s.value)&&(w.value=Number(s.value),w.numFmt=s.numFmt)}),await _(g,l,b,r)});let u=z(d);if(!p?.subTotal?.disableSubtotal){let i=l.addRow(d.map(()=>null));u.forEach((t,r)=>{if(t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"){let s=c.length+4-1,x=`SUM(${String.fromCharCode(65+r)}4:${String.fromCharCode(65+r)}${s})`,w=i.getCell(r+1),R=p?.subTotal?.enableCount&&m.length>0?" : "+o.detail.length:"",j=p?.subTotal?.captionItem?p?.subTotal?.captionItem:"";i.getCell(1).value=`${p?.subTotal?.caption||"SUB TOTAL"} ${R} ${j}`,i.getCell(1).alignment={horizontal:"center"},w.numFmt=t?.options?.format==="GR"?"#,##0.000":"#,##0",w.value={formula:x},i.getCell(r+1).value=t?.options.disabledFooter?"":f[t.key]}else i.getCell(r+1).value=""}),n?.grandTotalSetting?.colSpan&&l.mergeCells(`A${i.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${i.number}`),i.eachCell(t=>{t.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},t.font={color:{argb:n?.txtColor},bold:!0}})}}else{let u=z(d).map(t=>{if(t?.options?.format==="IMAGE"&&o[t.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:o[t.key]};let r=t?.options?.format==="DATETIME"?N(o[t.key]):o[t.key],b={horizontal:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"},s=t.key;return C[s]=(C[s]||0)+Number(r),{value:r,alignment:b,numFmt:t?.options?.format==="RP"?"#,##0":t?.options?.format==="GR"?"#,##0.000":void 0}}),i=l.addRow(u.map(t=>t.value));u.forEach((t,r)=>{let b=i.getCell(r+1),s=["center","right","left","fill","justify","centerContinuous","distributed"],x=["top","middle","bottom","distributed","justify"],w,R;t.alignment&&typeof t.alignment.horizontal=="string"&&s.includes(t.alignment.horizontal)&&(w=t.alignment.horizontal),t.alignment&&"vertical"in t.alignment&&typeof t.alignment.vertical=="string"&&x.includes(t.alignment.vertical)&&(R=t.alignment.vertical),b.alignment={...w?{horizontal:w}:{},...R?{vertical:R}:{}},t.numFmt&&typeof t.value=="number"&&!isNaN(t.value)&&(b.value=Number(t.value),b.numFmt=t.numFmt)}),await _(g,l,i,u)}});let T=l.addRow(d.map(()=>null)),F=z(d);p?.grandTotal?.disableGrandTotal||(F.forEach((o,f)=>{if(o?.options?.format==="RP"||o?.options?.format==="GR"||o?.options?.format==="NUMBER"){let i=c.length+4-1,t=`SUM(${String.fromCharCode(65+f)}4:${String.fromCharCode(65+f)}${i})`,r=T.getCell(f+1),b=p?.grandTotal?.enableCount?m.length>0?" : "+c.map(w=>w.detail.length).reduce((w,R)=>w+R,0):" : "+c.length:"",s=p?.grandTotal?.captionItem?p?.grandTotal?.captionItem:"",x=`${p?.grandTotal?.caption||"GRAND TOTAL"} ${b} ${s}`;T.getCell(1).value=x,T.getCell(1).alignment={horizontal:"center"},r.numFmt=o?.options?.format==="GR"?"#,##0.000":"#,##0",r.value={formula:t},T.getCell(f+1).value=o?.options.disabledFooter?"":C[o.key]}else T.getCell(f+1).value=""}),n?.grandTotalSetting?.colSpan&&l.mergeCells(`A${T.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${T.number}`),T.eachCell(o=>{o.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},o.font={color:{argb:n?.txtColor},bold:!0}})),n?.customize&&n.customize(l);let U=await g.xlsx.writeBuffer(),a=new Blob([U],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),y=document.createElement("a");y.href=URL.createObjectURL(a),y.download=`${n?.titleExcel||h}.xlsx`,document.body.appendChild(y),y.click(),document.body.removeChild(y)},H=q;import Q from"jspdf";import J from"jspdf-autotable";var Z=({columns:d,data:c,grouping:m,pdfSetting:e,date:n,title:h,footerSetting:p})=>{let g=new Q(e?.orientation,e?.unit,[e?.width||297,e?.height||210]),l=[],$=n?30:20;d=d.filter(a=>!a.options?.disabledColumn),g.setFontSize(10);let k=g.internal.pageSize.getWidth(),I=g.splitTextToSize(e?.textHeaderLeft||"",110);g.text(I,15,18),g.text(`${h||e?.titlePdf}`,k-15,18,{align:"right"}),n&&g.text(`${n.caption?n.caption:"TANGGAL "} : ${n?.start_date} ${n?.end_date?`s/d ${n?.end_date}`:""}`,k-15,22,{align:"right"}),g.setProperties({title:h||e?.titlePdf}),e?.finalY&&(console.log(e.finalY),$=e.finalY);let v=[],P=[],E=d.some(a=>a.child&&a.child.length>0);d.forEach(a=>{let y={textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`,fontStyle:"bold",...a?.options?.valign?{valign:a.options.valign}:{},halign:a?.options?.halign??(["RP","GR","NUMBER"].includes(a?.options?.format||"")?"right":"left")};E?a.child&&a.child.length>0?(v.push({content:a.label,colSpan:a.child.length,styles:y}),a.child.forEach(o=>{P.push({content:o.label,key:o.key,options:o.options,styles:{...y,halign:o?.options?.halign??(["RP","GR","NUMBER"].includes(o?.options?.format||"")?"right":"left")}})})):v.push({content:a.label,rowSpan:2,key:a.key,options:a.options,styles:y}):v.push({content:a.label,key:a.key,options:a.options,styles:y})}),l.push(v),E&&P.length>0&&l.push(P);let G={};c.forEach(a=>{if(a.detail.length>0){if(m.length>0){let f=A(d),i=[{content:m.map(t=>a[t]!==void 0||a[t]!==null?`${M(t)} : ${a[t]}`:"").filter(Boolean).join("  |  "),colSpan:f,styles:{fontStyle:"bold",halign:"left"}}];l.push(i)}let y={},o=z(d);if(a.detail.forEach(f=>{let u=o.map(i=>{let t=f[i.key],r=i.key;G[r]=(G[r]||0)+Number(t||0),y[r]=(y[r]||0)+Number(t||0);let b=i.options?.format==="IMAGE";return{content:(()=>{switch(i?.options?.format){case"RP":return t!==void 0?Number(t||0).toLocaleString("kr-ko"):"";case"GR":return t!==void 0?Number(t||0).toFixed(3):"";case"NUMBER":return t!==void 0?Number(t||0):"";case"IMAGE":return"";case"DATETIME":return t!==void 0?N(t||new Date):"";default:return t!==void 0?t.toString():""}})(),foto:b?t:null,styles:{halign:i?.options?.halign?i?.options?.halign:i?.options?.format==="RP"||i?.options?.format==="GR"||i?.options?.format==="NUMBER"||typeof t=="number"?"right":"left"}}});l.push(u)}),!p?.subTotal?.disableSubtotal){let f=[];o.forEach(r=>{let b=y[r.key];r?.options?.format==="RP"||r?.options?.format==="GR"||r?.options?.format==="NUMBER"?f.push({content:r?.options?.disabledFooter?"":(()=>{switch(r?.options?.format){case"RP":return b.toLocaleString("kr-ko");case"GR":return b.toFixed(3);case"NUMBER":return b;default:return b.toString()}})(),styles:{halign:r?.options?.halign||"right",textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`,fontStyle:"bold"}}):f.push({content:"",styles:{textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let u=e?.grandTotalSetting?.colSpan?Number(e?.grandTotalSetting?.colSpan||0)+1:0,i=p?.subTotal?.enableCount&&m.length>0?" : "+a.detail.length:"",t=p?.subTotal?.captionItem?p?.subTotal?.captionItem:"";f[0]={content:`${p?.subTotal?.caption||"SUB TOTAL"}${i} ${t}`,colSpan:u,styles:{textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},e?.grandTotalSetting?.colSpan&&f.splice(1,e?.grandTotalSetting?.colSpan),l.push(f)}}else{let y=(u,i)=>{let t=i[u.key],r=u.key;u.options?.disabledFooter||(G[r]=(G[r]||0)+Number(t||0));let b=(()=>{switch(u?.options?.format){case"RP":return t!==void 0?Number(t||0).toLocaleString("kr-ko"):"";case"GR":return t!==void 0?Number(t||0).toFixed(3):"";case"NUMBER":return t!==void 0?Number(t||0):"";case"IMAGE":return"";case"DATETIME":return t!==void 0?N(t||new Date):"";default:return t!==void 0?t?.toString():""}})(),s=u?.options?.halign?u?.options?.halign:u?.options?.format==="RP"||u?.options?.format==="GR"||u?.options?.format==="NUMBER"||typeof t=="number"?"right":"left",x=u.options?.format==="IMAGE";return{options:u?.options,content:b,foto:x?t:null,styles:{halign:s}}},f=z(d).map(u=>y(u,a));l.push(f)}});let C=z(d);if(!p?.grandTotal?.disableGrandTotal){let a=[];C.forEach(t=>{let r=G[t.key],b=["RP","GR","NUMBER"].includes(t?.options?.format||""),s=t?.options?.disabledFooter?"":(()=>{if(!b)return"";switch(t.options?.format){case"RP":return Number(r||0).toLocaleString("kr-KO");case"GR":return Number(r||0).toFixed(3);case"NUMBER":return Number(r||0);default:return(r||0).toString()}})();a.push({options:t?.options,content:s,styles:{halign:t?.options?.halign?t.options.halign:b?"right":"left",textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let y=Number(e?.grandTotalSetting?.colSpan||0),o=Math.min(y+1,C.length),f=p?.grandTotal?.enableCount?m.length>0?c.reduce((t,r)=>t+r.detail.length,0):c.length:0,u=p?.grandTotal?.captionItem||"",i=`${p?.grandTotal?.caption||"GRAND TOTAL"}`+(f?` : ${f}`:"")+(u?` ${u}`:"");for(a[0]={content:i,colSpan:o,styles:{textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},a.splice(1,o-1);a.length<C.length;)a.push({content:"",styles:{textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`,fontStyle:"bold"}});l.push(a)}if(typeof e?.addRow=="function"&&e?.addRow(l),!e?.disablePrintDate){let a=A(d);l.push([{content:`Print Date : ${N(`${new Date}`)}`,colSpan:a,styles:{textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}])}J(g,{head:[],body:l,startY:$,theme:e?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:e?.fontSIze||8},headStyles:{fontSize:e?.fontSIze||8,textColor:`#${e?.txtColor||"000"}`,fillColor:`#${e?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255],didParseCell:function(a){let y=a.column.index;C[y]?.options?.format==="IMAGE"&&a.cell.raw&&a.cell.raw.foto&&(a.row.height=20,a.cell.styles.valign="middle",a.cell.styles.halign="center")},didDrawCell:function(a){let{cell:y}=a,f=(y.raw||{}).foto,u=a.column.index;if(C[u]?.options?.format==="IMAGE"&&f){let r=y.x+(y.width-15)/2,b=y.y+(y.height-15)/2;try{g.addImage(f,"JPG",r,b,15,15)}catch(s){console.warn("\u274C Gagal render gambar:",s)}}}}),l=[],$=g.lastAutoTable.finalY;let T=g.internal.getNumberOfPages(),F=g.internal.pageSize.width,U=g.internal.pageSize.height;g.setFontSize(10);for(let a=1;a<T+1;a++){let y=F/2,o=U-10;g.setPage(a),g.text(`${a} of ${T}`,y,o,{align:"center"})}if(typeof e?.customize=="function"&&e.customize(g,$,J),e?.openNewTab){let a=g.output("bloburl");window.open(a)}else g.save(`${e?.titlePdf||h}.pdf`)},O=Z;var tt=d=>{let c=[],m=d.copy?2:1;for(let e=0;e<m;e++){let n=d.data.map(h=>{let p=d.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(p);)p=p.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(g,l,$)=>{let k=$.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(h[l])?h[l]:[h[l]]).reduce((P,E)=>P+k.replace(/\{([a-z0-9_]+)\}/gm,G=>{let C=G.replace(/(\{|\})/g,"");if(C.match(/nama_barang/)){let T=C.match(/nama_barang/),F=C==="nama_barang2"?[20,40]:C==="nama_barang3"?[40,60]:[0,20];return E[T]?.slice(...F).trim()||""}if(C.match(/deskripsi_jual/)){let T=C.match(/deskripsi_jual/),F=C==="deskripsi_jual2"?[20,40]:C==="deskripsi_jual3"?[40,60]:[0,20];return E[T]?.slice(...F).trim()||""}if(C.match(/deskripsi/)){let T=C.match(/deskripsi/),F=C==="deskripsi2"?[20,40]:C==="deskripsi3"?[40,60]:[0,20];return E[T]?.slice(...F).trim()||""}return E[C]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return p.replace(/\{([a-z0-9_]+)\}/gm,g=>{let l=g.replace(/(\{|\})/g,"");return l.match(/auto_cut/)?`
VA`:h[l]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let h in n)n[h]+=`

`;c.push(...n)}return c},et=async(d,c)=>{let m=tt(d),e=new Blob([m?.join(`
`)||""],{type:"text/plain"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=c,document.body.appendChild(n),n.click(),document.body.removeChild(n)},X=et;var kt=({columns:d,data:c,grouping:m,date:e,type:n,txtSetting:h,pdfSetting:p,excelSetting:g,title:l,footerSetting:$})=>{let k={data:[h?.dataTxt],template:h?.templateTxt,copy:h?.copy};if(c.length===0)throw new Error("Data is required");if(n.length===0)throw new Error("Type is required");if(!Y(n))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');n.forEach(I=>{I==="PDF"?O({pdfSetting:p,date:e,data:c,type:n,columns:d,grouping:m,title:l,footerSetting:$}):I==="TXT"?X(k,h?.titleTxt||""):I==="EXCEL"?H({date:e,data:c,type:n,columns:d,grouping:m,excelSetting:g,title:l,footerSetting:$}):(H({date:e,data:c,type:n,columns:d,grouping:m,excelSetting:g,title:l}),O({pdfSetting:p,date:e,data:c,type:n,columns:d,grouping:m,title:l}),X(k,h?.titleTxt||""))})};export{kt as ExportData};
//# sourceMappingURL=index.mjs.map