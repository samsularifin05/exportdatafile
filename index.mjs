var V=["EXCEL","PDF","TXT","ALL"];function L(r){let l=new Date(r),m=l.getFullYear(),t=String(l.getMonth()+1).padStart(2,"0"),n=String(l.getDate()).padStart(2,"0"),h=String(l.getHours()).padStart(2,"0"),u=String(l.getMinutes()).padStart(2,"0"),g=String(l.getSeconds()).padStart(2,"0");return`${n}-${t}-${m} ${h}:${u}:${g}`}function K(r){return r.every(l=>V.includes(l))}function M(r){let l=0;return r.forEach(m=>{m.child&&m.child.length>0?l+=M(m.child):l+=1}),l}var D=r=>{let l=[];return r.forEach(m=>{m.child&&m.child.length>0?l.push(...D(m.child)):l.push(m)}),l},B=r=>r.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ");async function X(r,l,m,t){for(let n=0;n<t.length;n++){let h=t[n];if(h?.isImage&&h?.imageSrc&&typeof h.imageSrc=="string"&&h.imageSrc.startsWith("data:image"))try{let{buffer:u,extension:g}=Z(h.imageSrc),a=r.addImage({buffer:u,extension:g});l.addImage(a,{tl:{col:n,row:m.number-1},ext:{width:70,height:60},editAs:"oneCell"}),(!m.height||m.height<60)&&(m.height=35)}catch(u){console.error("\u274C Error adding image to row:",u),m.getCell(n+1).value="[Image]"}}}function Z(r){let l=r.match(/^data:image\/(\w+);base64,(.*)$/);if(!l)throw new Error("Invalid base64 image format");let m=l[1]==="jpg"?"jpeg":l[1],t=l[2],n=atob(t),h=n.length,u=new Uint8Array(h);for(let g=0;g<h;g++)u[g]=n.charCodeAt(g);return{buffer:u,extension:m}}import tt from"exceljs";var et=async({columns:r,data:l,grouping:m,date:t,excelSetting:n,title:h,footerSetting:u})=>{let g=new tt.Workbook;r=r.filter(e=>!e.options?.disabledColumn);let a=g.addWorksheet(h||n?.titleExcel),v=M(r),x=a.addRow([]);x.getCell(1).value=h||n?.titleExcel,x.getCell(1).alignment={horizontal:"center"};let P=a.getColumn(v).letter;if(a.mergeCells(`A${x.number}:${P}${x.number}`),x.eachCell(e=>{e.font={color:{argb:"000000"},bold:!0,size:12}}),t){let e=a.addRow([]);e.getCell(1).value=`${t.caption?t.caption:"Tanggal "} : ${t?.start_date} ${t?.end_date?`s/d ${t?.end_date}`:""}`,e.getCell(1).alignment={horizontal:"center"},a.mergeCells(`A${e.number}:${P}${e.number}`),e.eachCell(s=>{s.font={color:{argb:"00000"},bold:!0,size:12}})}let I=a.addRow([]);I.getCell(1).value=n?.additionalTextHeader||"",I.getCell(1).alignment={horizontal:"center"},a.mergeCells(`A${I.number}:${P}${I.number}`),I.eachCell(e=>{e.font={color:{argb:"000000"},bold:!0,size:12}});let N=r.some(e=>e.child&&e.child.length>0),R=a.addRow([]),$=N?a.addRow([]):null;r.forEach(e=>{if(e.child&&e.child.length>0){let s=R.actualCellCount+1,E=e.child.length;R.getCell(s).value=e.label,E>1&&a.mergeCells(R.number,s,R.number,s+E-1);for(let c=s;c<s+E;c++){let i=R.getCell(c);i.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},i.font={color:{argb:n?.txtColor||"000000"},bold:!0},i.alignment={horizontal:"center",vertical:"middle"}}e.child.forEach((c,i)=>{if($){let p=$.getCell(s+i);p.value=c.label,p.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},p.font={color:{argb:n?.txtColor||"000000"},bold:!0};let y=c.options?.halign||(["RP","GR","NUMBER"].includes(c?.options?.format||"")?"right":"left"),f=c.options?.valign||"middle";p.alignment={horizontal:y,vertical:f}}})}else{let s=R.actualCellCount+1;R.getCell(s).value=e.label,R.getCell(s).fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},R.getCell(s).font={color:{argb:n?.txtColor||"000000"},bold:!0},R.getCell(s).alignment={horizontal:e.options?.halign||"center",vertical:e.options?.valign||"middle"},N&&$&&a.mergeCells(R.number,s,$.number,s)}});let b={};l.forEach(async e=>{if(m.length>0){let s=M(r),E=m.map(f=>e[f]!==void 0?`${B(f)} : ${e[f]}`:"").filter(Boolean).join("  |  "),c=a.addRow([E]);a.mergeCells(`A${c.number}:${String.fromCharCode(64+s)}${c.number}`),c.getCell(1).alignment={horizontal:"left"},c.getCell(1).font={bold:!0};let i={};e.detail.forEach(async f=>{let C=D(r).map(d=>{if(d?.options?.format==="IMAGE"&&f[d.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:f[d.key]};let T=d?.options?.format==="DATETIME"?L(f[d.key]):f[d.key],F={horizontal:d?.options?.halign?d?.options?.halign:d?.options?.format==="RP"||d?.options?.format==="GR"||d?.options?.format==="NUMBER"?"right":"left"},z=d.key;return b[z]=(b[z]||0)+Number(T),i[z]=(i[z]||0)+Number(T),{value:T,alignment:F,numFmt:d?.options?.format==="RP"?"#,##0":d?.options?.format==="GR"?"#,##0.000":void 0}}),G=a.addRow(C.map(d=>d.value));await X(g,a,G,C),C.forEach((d,T)=>{let F=G.getCell(T+1),z=["center","right","left","fill","justify","centerContinuous","distributed"],Q=["top","middle","bottom","distributed","justify"],O,H;d.alignment&&typeof d.alignment.horizontal=="string"&&z.includes(d.alignment.horizontal)&&(O=d.alignment.horizontal),d.alignment&&"vertical"in d.alignment&&typeof d.alignment.vertical=="string"&&Q.includes(d.alignment.vertical)&&(H=d.alignment.vertical),F.alignment={...O?{horizontal:O}:{},...H?{vertical:H}:{}},d.numFmt&&(F.numFmt=d.numFmt)})});let p=D(r),y=a.addRow(r.map(()=>null));p.forEach((f,k)=>{if(f?.options?.format==="RP"||f?.options?.format==="GR"||f?.options?.format==="NUMBER"){let G=l.length+4-1,d=`SUM(${String.fromCharCode(65+k)}4:${String.fromCharCode(65+k)}${G})`,T=y.getCell(k+1),F=u?.subTotal?.enableCount&&m.length>0?" : "+e.detail.length:"",z=u?.subTotal?.captionItem?u?.subTotal?.captionItem:"";y.getCell(1).value=`${u?.subTotal?.caption||"SUB TOTAL"} ${F} ${z}`,y.getCell(1).alignment={horizontal:"center"},T.numFmt=f?.options?.format==="GR"?"#,##0.000":"#,##0",T.value={formula:d},y.getCell(k+1).value=f?.options.disabledFooter?"":i[f.key]}else y.getCell(k+1).value=""}),n?.grandTotalSetting?.colSpan&&a.mergeCells(`A${y.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${y.number}`),y.eachCell(f=>{f.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},f.font={color:{argb:n?.txtColor},bold:!0}})}else{let E=D(r).map(i=>{if(i?.options?.format==="IMAGE"&&e[i.key])return{value:"",options:i?.options,alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:e[i.key]};let p=i?.options?.format==="DATETIME"?L(e[i.key]):e[i.key],y={vertical:"middle",horizontal:i?.options?.halign?i?.options?.halign:i?.options?.format==="RP"||i?.options?.format==="GR"||i?.options?.format==="NUMBER"?"right":"left"},f=i.key;return b[f]=(b[f]||0)+Number(p),{value:p,options:i?.options,alignment:y,numFmt:i?.options?.format==="RP"?"#,##0":i?.options?.format==="GR"?"#,##0.000":void 0}}),c=a.addRow(E.map(async i=>i.value));await X(g,a,c,E),E.forEach((i,p)=>{let y=c.getCell(p+1),f=i.alignment.vertical?String(i.alignment.vertical||"bottom"):"bottom",k="";(f==="middle"||f==="bottom"||f==="justify"||f==="distributed"||f==="top")&&(k=f),y.alignment={horizontal:i.alignment.horizontal?i.alignment.horizontal:"left",vertical:k},i.numFmt&&(y.numFmt=i.numFmt)})}});let w=a.addRow(r.map(()=>null));D(r).forEach((e,s)=>{if(e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"){let c=l.length+4-1,i=`SUM(${String.fromCharCode(65+s)}4:${String.fromCharCode(65+s)}${c})`,p=w.getCell(s+1),y=u?.grandTotal?.enableCount?m.length>0?" : "+l.map(C=>C.detail.length).reduce((C,G)=>C+G,0):" : "+l.length:"",f=u?.grandTotal?.captionItem?u?.grandTotal?.captionItem:"",k=`${u?.grandTotal?.caption||"GRAND TOTAL"} ${y} ${f}`;w.getCell(1).value=k,w.getCell(1).alignment={horizontal:"center"},p.numFmt=e?.options?.format==="GR"?"#,##0.000":"#,##0",p.value={formula:i},w.getCell(s+1).value=e?.options.disabledFooter?"":b[e.key]}else w.getCell(s+1).value=""}),n?.grandTotalSetting?.colSpan&&a.mergeCells(`A${w.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${w.number}`),w.eachCell(e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},e.font={color:{argb:n?.txtColor},bold:!0}}),n?.customize&&n.customize(a);let j=await g.xlsx.writeBuffer(),_=new Blob([j],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=document.createElement("a");o.href=URL.createObjectURL(_),o.download=`${n?.titleExcel||h}.xlsx`,document.body.appendChild(o),o.click(),document.body.removeChild(o)},Y=et;import ot from"jspdf";import q from"jspdf-autotable";var nt=({columns:r,data:l,grouping:m,pdfSetting:t,date:n,title:h,footerSetting:u})=>{let g=new ot(t?.orientation,t?.unit,[t?.width||297,t?.height||210]),a=[],v=n?30:20;r=r.filter(o=>!o.options?.disabledColumn),g.setFontSize(10);let x=g.internal.pageSize.getWidth(),P=g.splitTextToSize(t?.textHeaderLeft||"",110);g.text(P,15,18),g.text(`${h||t?.titlePdf}`,x-15,18,{align:"right"}),n&&g.text(`${n.caption?n.caption:"TANGGAL "} : ${n?.start_date} ${n?.end_date?`s/d ${n?.end_date}`:""}`,x-15,22,{align:"right"}),g.setProperties({title:h||t?.titlePdf}),t?.finalY&&(console.log(t.finalY),v=t.finalY);let I=[],N=[],R=r.some(o=>o.child&&o.child.length>0);r.forEach(o=>{let e={textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",...o?.options?.valign?{valign:o.options.valign}:{},halign:o?.options?.halign??(["RP","GR","NUMBER"].includes(o?.options?.format||"")?"right":"left")};R?o.child&&o.child.length>0?(I.push({content:o.label,colSpan:o.child.length,styles:e}),o.child.forEach(s=>{N.push({content:s.label,key:s.key,options:s.options,styles:{...e,halign:s?.options?.halign??(["RP","GR","NUMBER"].includes(s?.options?.format||"")?"right":"left")}})})):I.push({content:o.label,rowSpan:2,key:o.key,options:o.options,styles:e}):I.push({content:o.label,key:o.key,options:o.options,styles:e})}),a.push(I),R&&N.length>0&&a.push(N);let $={};l.forEach(o=>{if(m.length>0){let e=M(r),E=[{content:m.map(C=>o[C]!==void 0?`${B(C)} : ${o[C]}`:"").filter(Boolean).join("  |  "),colSpan:e,styles:{fontStyle:"bold",halign:"left"}}];a.push(E);let c={},i=D(r);o.detail.forEach(C=>{let G=i.map(d=>{let T=C[d.key],F=d.key;$[F]=($[F]||0)+Number(T||0),c[F]=(c[F]||0)+Number(T||0);let z=d.options?.format==="IMAGE";return{content:(()=>{switch(d?.options?.format){case"RP":return T!==void 0?Number(T||0).toLocaleString("kr-ko"):"";case"GR":return T!==void 0?Number(T||0).toFixed(3):"";case"NUMBER":return T!==void 0?Number(T||0):"";case"IMAGE":return"";case"DATETIME":return T!==void 0?L(T||new Date):"";default:return T!==void 0?T.toString():""}})(),foto:z?T:null,styles:{halign:d?.options?.halign?d?.options?.halign:d?.options?.format==="RP"||d?.options?.format==="GR"||d?.options?.format==="NUMBER"||typeof T=="number"?"right":"left"}}});a.push(G)});let p=[];i.forEach(C=>{let G=c[C.key];C?.options?.format==="RP"||C?.options?.format==="GR"||C?.options?.format==="NUMBER"?p.push({content:C?.options?.disabledFooter?"":(()=>{switch(C?.options?.format){case"RP":return G.toLocaleString("kr-ko");case"GR":return G.toFixed(3);case"NUMBER":return G;default:return G.toString()}})(),styles:{halign:C?.options?.halign||"right",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}}):p.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let y=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0,f=u?.subTotal?.enableCount&&m.length>0?" : "+o.detail.length:"",k=u?.subTotal?.captionItem?u?.subTotal?.captionItem:"";p[0]={content:`${u?.subTotal?.caption||"SUB TOTAL"}${f} ${k}`,colSpan:y,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&p.splice(1,t?.grandTotalSetting?.colSpan),a.push(p)}else{let e=(c,i)=>{let p=i[c.key],y=c.key;c.options?.disabledFooter||($[y]=($[y]||0)+Number(p||0));let f=(()=>{switch(c?.options?.format){case"RP":return p!==void 0?Number(p||0).toLocaleString("kr-ko"):"";case"GR":return p!==void 0?Number(p||0).toFixed(3):"";case"NUMBER":return p!==void 0?Number(p||0):"";case"IMAGE":return"";case"DATETIME":return p!==void 0?L(p||new Date):"";default:return p!==void 0?p?.toString():""}})(),k=c?.options?.halign?c?.options?.halign:c?.options?.format==="RP"||c?.options?.format==="GR"||c?.options?.format==="NUMBER"||typeof p=="number"?"right":"left",C=c.options?.format==="IMAGE";return{options:c?.options,content:f,foto:C?p:null,styles:{halign:k}}},E=D(r).map(c=>e(c,o));a.push(E)}});let b=D(r),w=[];if(b.forEach(o=>{let e=$[o.key],s=["RP","GR","NUMBER"].includes(o?.options?.format||""),E=o?.options?.disabledFooter?"":(()=>{if(!s)return"";switch(o.options?.format){case"RP":return Number(e||0).toLocaleString("kr-KO");case"GR":return Number(e||0).toFixed(3);case"NUMBER":return Number(e||0);default:return(e||0).toString()}})();w.push({options:o?.options,content:E,styles:{halign:o?.options?.halign?o.options.halign:s?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})}),!t?.grandTotalSetting?.disableGrandTotal){let o=Number(t?.grandTotalSetting?.colSpan||0),e=Math.min(o+1,b.length),s=u?.grandTotal?.enableCount?m.length>0?l.reduce((i,p)=>i+p.detail.length,0):l.length:0,E=u?.grandTotal?.captionItem||"",c=`${u?.grandTotal?.caption||"GRAND TOTAL"}`+(s?` : ${s}`:"")+(E?` ${E}`:"");for(w[0]={content:c,colSpan:e,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},w.splice(1,e-1);w.length<b.length;)w.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}});a.push(w)}if(typeof t?.addRow=="function"&&t?.addRow(a),!t?.disablePrintDate){let o=M(r);a.push([{content:`Print Date : ${L(`${new Date}`)}`,colSpan:o,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}])}q(g,{head:[],body:a,startY:v,theme:t?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:t?.fontSIze||8},headStyles:{fontSize:t?.fontSIze||8,textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255],didParseCell:function(o){let e=o.column.index;b[e]?.options?.format==="IMAGE"&&o.cell.raw&&o.cell.raw.foto&&(o.row.height=20,o.cell.styles.valign="middle",o.cell.styles.halign="center")},didDrawCell:function(o){let{cell:e}=o,E=(e.raw||{}).foto,c=o.column.index;if(b[c]?.options?.format==="IMAGE"&&E){let y=e.x+(e.width-15)/2,f=e.y+(e.height-15)/2;try{g.addImage(E,"JPG",y,f,15,15)}catch(k){console.warn("\u274C Gagal render gambar:",k)}}}}),a=[],v=g.lastAutoTable.finalY;let A=g.internal.getNumberOfPages(),j=g.internal.pageSize.width,_=g.internal.pageSize.height;g.setFontSize(10);for(let o=1;o<A+1;o++){let e=j/2,s=_-10;g.setPage(o),g.text(`${o} of ${A}`,e,s,{align:"center"})}if(typeof t?.customize=="function"&&t.customize(g,v,q),t?.openNewTab){let o=g.output("bloburl");window.open(o)}else g.save(`${t?.titlePdf||h}.pdf`)},J=nt;var at=r=>{let l=[],m=r.copy?2:1;for(let t=0;t<m;t++){let n=r.data.map(h=>{let u=r.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(u);)u=u.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(g,a,v)=>{let x=v.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(h[a])?h[a]:[h[a]]).reduce((N,R)=>N+x.replace(/\{([a-z0-9_]+)\}/gm,$=>{let b=$.replace(/(\{|\})/g,"");if(b.match(/nama_barang/)){let w=b.match(/nama_barang/),A=b==="nama_barang2"?[20,40]:b==="nama_barang3"?[40,60]:[0,20];return R[w]?.slice(...A).trim()||""}if(b.match(/deskripsi_jual/)){let w=b.match(/deskripsi_jual/),A=b==="deskripsi_jual2"?[20,40]:b==="deskripsi_jual3"?[40,60]:[0,20];return R[w]?.slice(...A).trim()||""}if(b.match(/deskripsi/)){let w=b.match(/deskripsi/),A=b==="deskripsi2"?[20,40]:b==="deskripsi3"?[40,60]:[0,20];return R[w]?.slice(...A).trim()||""}return R[b]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return u.replace(/\{([a-z0-9_]+)\}/gm,g=>{let a=g.replace(/(\{|\})/g,"");return a.match(/auto_cut/)?`
VA`:h[a]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let h in n)n[h]+=`

`;l.push(...n)}return l},rt=async(r,l)=>{let m=at(r),t=new Blob([m?.join(`
`)||""],{type:"text/plain"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=l,document.body.appendChild(n),n.click(),document.body.removeChild(n)},W=rt;var vt=({columns:r,data:l,grouping:m,date:t,type:n,txtSetting:h,pdfSetting:u,excelSetting:g,title:a,footerSetting:v})=>{let x={data:[h?.dataTxt],template:h?.templateTxt,copy:h?.copy};if(l.length===0)throw new Error("Data is required");if(n.length===0)throw new Error("Type is required");if(!K(n))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');n.forEach(P=>{P==="PDF"?J({pdfSetting:u,date:t,data:l,type:n,columns:r,grouping:m,title:a,footerSetting:v}):P==="TXT"?W(x,h?.titleTxt||""):P==="EXCEL"?Y({date:t,data:l,type:n,columns:r,grouping:m,excelSetting:g,title:a,footerSetting:v}):(Y({date:t,data:l,type:n,columns:r,grouping:m,excelSetting:g,title:a}),J({pdfSetting:u,date:t,data:l,type:n,columns:r,grouping:m,title:a}),W(x,h?.titleTxt||""))})};export{vt as ExportData};
//# sourceMappingURL=index.mjs.map