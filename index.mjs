var W=["EXCEL","PDF","TXT","ALL"];function D(l){let i=new Date(l),m=i.getFullYear(),t=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0"),h=String(i.getHours()).padStart(2,"0"),p=String(i.getMinutes()).padStart(2,"0"),g=String(i.getSeconds()).padStart(2,"0");return`${n}-${t}-${m} ${h}:${p}:${g}`}function K(l){return l.every(i=>W.includes(i))}function M(l){let i=0;return l.forEach(m=>{m.child&&m.child.length>0?i+=M(m.child):i+=1}),i}var N=l=>{let i=[];return l.forEach(m=>{m.child&&m.child.length>0?i.push(...N(m.child)):i.push(m)}),i},B=l=>l.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ");async function X(l,i,m,t){for(let n=0;n<t.length;n++){let h=t[n];if(h?.isImage&&h?.imageSrc&&typeof h.imageSrc=="string"&&h.imageSrc.startsWith("data:image"))try{let{buffer:p,extension:g}=Z(h.imageSrc),r=l.addImage({buffer:p,extension:g});i.addImage(r,{tl:{col:n,row:m.number-1},ext:{width:70,height:60},editAs:"oneCell"}),(!m.height||m.height<60)&&(m.height=35)}catch(p){console.error("\u274C Error adding image to row:",p),m.getCell(n+1).value="[Image]"}}}function Z(l){let i=l.match(/^data:image\/(\w+);base64,(.*)$/);if(!i)throw new Error("Invalid base64 image format");let m=i[1]==="jpg"?"jpeg":i[1],t=i[2],n=atob(t),h=n.length,p=new Uint8Array(h);for(let g=0;g<h;g++)p[g]=n.charCodeAt(g);return{buffer:p,extension:m}}import tt from"exceljs";var et=async({columns:l,data:i,grouping:m,date:t,excelSetting:n,title:h,footerSetting:p})=>{let g=new tt.Workbook;l=l.filter(e=>!e.options?.disabledColumn);let r=g.addWorksheet(h||n?.titleExcel),I=M(l),G=r.addRow([]);G.getCell(1).value=h||n?.titleExcel,G.getCell(1).alignment={horizontal:"center"};let F=r.getColumn(I).letter;if(r.mergeCells(`A${G.number}:${F}${G.number}`),G.eachCell(e=>{e.font={color:{argb:"000000"},bold:!0,size:12}}),t){let e=r.addRow([]);e.getCell(1).value=`${t.caption?t.caption:"Tanggal "} : ${t?.start_date} ${t?.end_date?`s/d ${t?.end_date}`:""}`,e.getCell(1).alignment={horizontal:"center"},r.mergeCells(`A${e.number}:${F}${e.number}`),e.eachCell(d=>{d.font={color:{argb:"00000"},bold:!0,size:12}})}let z=r.addRow([]);z.getCell(1).value=n?.additionalTextHeader||"",z.getCell(1).alignment={horizontal:"center"},r.mergeCells(`A${z.number}:${F}${z.number}`),z.eachCell(e=>{e.font={color:{argb:"000000"},bold:!0,size:12}});let L=l.some(e=>e.child&&e.child.length>0),R=r.addRow([]),$=L?r.addRow([]):null;l.forEach(e=>{if(e.child&&e.child.length>0){let d=R.actualCellCount+1,E=e.child.length;R.getCell(d).value=e.label,E>1&&r.mergeCells(R.number,d,R.number,d+E-1);for(let c=d;c<d+E;c++){let a=R.getCell(c);a.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},a.font={color:{argb:n?.txtColor||"000000"},bold:!0},a.alignment={horizontal:"center",vertical:"middle"}}e.child.forEach((c,a)=>{if($){let f=$.getCell(d+a);f.value=c.label,f.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},f.font={color:{argb:n?.txtColor||"000000"},bold:!0};let C=c.options?.halign||(["RP","GR","NUMBER"].includes(c?.options?.format||"")?"right":"left"),u=c.options?.valign||"middle";f.alignment={horizontal:C,vertical:u}}})}else{let d=R.actualCellCount+1;R.getCell(d).value=e.label,R.getCell(d).fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},R.getCell(d).font={color:{argb:n?.txtColor||"000000"},bold:!0},R.getCell(d).alignment={horizontal:e.options?.halign||"center",vertical:e.options?.valign||"middle"},L&&$&&r.mergeCells(R.number,d,$.number,d)}});let y={};i.forEach(async e=>{if(m.length>0){let d=M(l),E=m.map(u=>e[u]!==void 0?`${B(u)} : ${e[u]}`:"").filter(Boolean).join("  |  "),c=r.addRow([E]);r.mergeCells(`A${c.number}:${String.fromCharCode(64+d)}${c.number}`),c.getCell(1).alignment={horizontal:"left"},c.getCell(1).font={bold:!0};let a={};e.detail.forEach(async u=>{let b=N(l).map(s=>{if(s?.options?.format==="IMAGE"&&u[s.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:u[s.key]};let T=s?.options?.format==="DATETIME"?D(u[s.key]):u[s.key],v={horizontal:s?.options?.halign?s?.options?.halign:s?.options?.format==="RP"||s?.options?.format==="GR"||s?.options?.format==="NUMBER"?"right":"left"},P=s.key;return y[P]=(y[P]||0)+Number(T),a[P]=(a[P]||0)+Number(T),{value:T,alignment:v,numFmt:s?.options?.format==="RP"?"#,##0":s?.options?.format==="GR"?"#,##0.000":void 0}}),k=r.addRow(b.map(s=>s.value));b.forEach((s,T)=>{let v=k.getCell(T+1),P=["center","right","left","fill","justify","centerContinuous","distributed"],Q=["top","middle","bottom","distributed","justify"],H,O;s.alignment&&typeof s.alignment.horizontal=="string"&&P.includes(s.alignment.horizontal)&&(H=s.alignment.horizontal),s.alignment&&"vertical"in s.alignment&&typeof s.alignment.vertical=="string"&&Q.includes(s.alignment.vertical)&&(O=s.alignment.vertical),v.alignment={...H?{horizontal:H}:{},...O?{vertical:O}:{}},s.numFmt&&typeof s.value=="number"&&!isNaN(s.value)&&(v.value=Number(s.value),v.numFmt=s.numFmt)}),await X(g,r,k,b)});let f=N(l),C=r.addRow(l.map(()=>null));f.forEach((u,x)=>{if(u?.options?.format==="RP"||u?.options?.format==="GR"||u?.options?.format==="NUMBER"){let k=i.length+4-1,s=`SUM(${String.fromCharCode(65+x)}4:${String.fromCharCode(65+x)}${k})`,T=C.getCell(x+1),v=p?.subTotal?.enableCount&&m.length>0?" : "+e.detail.length:"",P=p?.subTotal?.captionItem?p?.subTotal?.captionItem:"";C.getCell(1).value=`${p?.subTotal?.caption||"SUB TOTAL"} ${v} ${P}`,C.getCell(1).alignment={horizontal:"center"},T.numFmt=u?.options?.format==="GR"?"#,##0.000":"#,##0",T.value={formula:s},C.getCell(x+1).value=u?.options.disabledFooter?"":a[u.key]}else C.getCell(x+1).value=""}),n?.grandTotalSetting?.colSpan&&r.mergeCells(`A${C.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${C.number}`),C.eachCell(u=>{u.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},u.font={color:{argb:n?.txtColor},bold:!0}})}else{let E=N(l).map(a=>{if(a?.options?.format==="IMAGE"&&e[a.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:e[a.key]};let f=a?.options?.format==="DATETIME"?D(e[a.key]):e[a.key],C={horizontal:a?.options?.halign?a?.options?.halign:a?.options?.format==="RP"||a?.options?.format==="GR"||a?.options?.format==="NUMBER"?"right":"left"},u=a.key;return y[u]=(y[u]||0)+Number(f),{value:f,alignment:C,numFmt:a?.options?.format==="RP"?"#,##0":a?.options?.format==="GR"?"#,##0.000":void 0}}),c=r.addRow(E.map(a=>a.value));E.forEach((a,f)=>{let C=c.getCell(f+1),u=["center","right","left","fill","justify","centerContinuous","distributed"],x=["top","middle","bottom","distributed","justify"],b,k;a.alignment&&typeof a.alignment.horizontal=="string"&&u.includes(a.alignment.horizontal)&&(b=a.alignment.horizontal),a.alignment&&"vertical"in a.alignment&&typeof a.alignment.vertical=="string"&&x.includes(a.alignment.vertical)&&(k=a.alignment.vertical),C.alignment={...b?{horizontal:b}:{},...k?{vertical:k}:{}},a.numFmt&&typeof a.value=="number"&&!isNaN(a.value)&&(C.value=Number(a.value),C.numFmt=a.numFmt)}),await X(g,r,c,E)}});let w=r.addRow(l.map(()=>null));N(l).forEach((e,d)=>{if(e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"){let c=i.length+4-1,a=`SUM(${String.fromCharCode(65+d)}4:${String.fromCharCode(65+d)}${c})`,f=w.getCell(d+1),C=p?.grandTotal?.enableCount?m.length>0?" : "+i.map(b=>b.detail.length).reduce((b,k)=>b+k,0):" : "+i.length:"",u=p?.grandTotal?.captionItem?p?.grandTotal?.captionItem:"",x=`${p?.grandTotal?.caption||"GRAND TOTAL"} ${C} ${u}`;w.getCell(1).value=x,w.getCell(1).alignment={horizontal:"center"},f.numFmt=e?.options?.format==="GR"?"#,##0.000":"#,##0",f.value={formula:a},w.getCell(d+1).value=e?.options.disabledFooter?"":y[e.key]}else w.getCell(d+1).value=""}),n?.grandTotalSetting?.colSpan&&r.mergeCells(`A${w.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${w.number}`),w.eachCell(e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},e.font={color:{argb:n?.txtColor},bold:!0}}),n?.customize&&n.customize(r);let S=await g.xlsx.writeBuffer(),_=new Blob([S],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=document.createElement("a");o.href=URL.createObjectURL(_),o.download=`${n?.titleExcel||h}.xlsx`,document.body.appendChild(o),o.click(),document.body.removeChild(o)},V=et;import ot from"jspdf";import q from"jspdf-autotable";var nt=({columns:l,data:i,grouping:m,pdfSetting:t,date:n,title:h,footerSetting:p})=>{let g=new ot(t?.orientation,t?.unit,[t?.width||297,t?.height||210]),r=[],I=n?30:20;l=l.filter(o=>!o.options?.disabledColumn),g.setFontSize(10);let G=g.internal.pageSize.getWidth(),F=g.splitTextToSize(t?.textHeaderLeft||"",110);g.text(F,15,18),g.text(`${h||t?.titlePdf}`,G-15,18,{align:"right"}),n&&g.text(`${n.caption?n.caption:"TANGGAL "} : ${n?.start_date} ${n?.end_date?`s/d ${n?.end_date}`:""}`,G-15,22,{align:"right"}),g.setProperties({title:h||t?.titlePdf}),t?.finalY&&(console.log(t.finalY),I=t.finalY);let z=[],L=[],R=l.some(o=>o.child&&o.child.length>0);l.forEach(o=>{let e={textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",...o?.options?.valign?{valign:o.options.valign}:{},halign:o?.options?.halign??(["RP","GR","NUMBER"].includes(o?.options?.format||"")?"right":"left")};R?o.child&&o.child.length>0?(z.push({content:o.label,colSpan:o.child.length,styles:e}),o.child.forEach(d=>{L.push({content:d.label,key:d.key,options:d.options,styles:{...e,halign:d?.options?.halign??(["RP","GR","NUMBER"].includes(d?.options?.format||"")?"right":"left")}})})):z.push({content:o.label,rowSpan:2,key:o.key,options:o.options,styles:e}):z.push({content:o.label,key:o.key,options:o.options,styles:e})}),r.push(z),R&&L.length>0&&r.push(L);let $={};i.forEach(o=>{if(m.length>0){let e=M(l),E=[{content:m.map(b=>o[b]!==void 0?`${B(b)} : ${o[b]}`:"").filter(Boolean).join("  |  "),colSpan:e,styles:{fontStyle:"bold",halign:"left"}}];r.push(E);let c={},a=N(l);o.detail.forEach(b=>{let k=a.map(s=>{let T=b[s.key],v=s.key;$[v]=($[v]||0)+Number(T||0),c[v]=(c[v]||0)+Number(T||0);let P=s.options?.format==="IMAGE";return{content:(()=>{switch(s?.options?.format){case"RP":return T!==void 0?Number(T||0).toLocaleString("kr-ko"):"";case"GR":return T!==void 0?Number(T||0).toFixed(3):"";case"NUMBER":return T!==void 0?Number(T||0):"";case"IMAGE":return"";case"DATETIME":return T!==void 0?D(T||new Date):"";default:return T!==void 0?T.toString():""}})(),foto:P?T:null,styles:{halign:s?.options?.halign?s?.options?.halign:s?.options?.format==="RP"||s?.options?.format==="GR"||s?.options?.format==="NUMBER"||typeof T=="number"?"right":"left"}}});r.push(k)});let f=[];a.forEach(b=>{let k=c[b.key];b?.options?.format==="RP"||b?.options?.format==="GR"||b?.options?.format==="NUMBER"?f.push({content:b?.options?.disabledFooter?"":(()=>{switch(b?.options?.format){case"RP":return k.toLocaleString("kr-ko");case"GR":return k.toFixed(3);case"NUMBER":return k;default:return k.toString()}})(),styles:{halign:b?.options?.halign||"right",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}}):f.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let C=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0,u=p?.subTotal?.enableCount&&m.length>0?" : "+o.detail.length:"",x=p?.subTotal?.captionItem?p?.subTotal?.captionItem:"";f[0]={content:`${p?.subTotal?.caption||"SUB TOTAL"}${u} ${x}`,colSpan:C,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&f.splice(1,t?.grandTotalSetting?.colSpan),r.push(f)}else{let e=(c,a)=>{let f=a[c.key],C=c.key;c.options?.disabledFooter||($[C]=($[C]||0)+Number(f||0));let u=(()=>{switch(c?.options?.format){case"RP":return f!==void 0?Number(f||0).toLocaleString("kr-ko"):"";case"GR":return f!==void 0?Number(f||0).toFixed(3):"";case"NUMBER":return f!==void 0?Number(f||0):"";case"IMAGE":return"";case"DATETIME":return f!==void 0?D(f||new Date):"";default:return f!==void 0?f?.toString():""}})(),x=c?.options?.halign?c?.options?.halign:c?.options?.format==="RP"||c?.options?.format==="GR"||c?.options?.format==="NUMBER"||typeof f=="number"?"right":"left",b=c.options?.format==="IMAGE";return{options:c?.options,content:u,foto:b?f:null,styles:{halign:x}}},E=N(l).map(c=>e(c,o));r.push(E)}});let y=N(l),w=[];if(y.forEach(o=>{let e=$[o.key],d=["RP","GR","NUMBER"].includes(o?.options?.format||""),E=o?.options?.disabledFooter?"":(()=>{if(!d)return"";switch(o.options?.format){case"RP":return Number(e||0).toLocaleString("kr-KO");case"GR":return Number(e||0).toFixed(3);case"NUMBER":return Number(e||0);default:return(e||0).toString()}})();w.push({options:o?.options,content:E,styles:{halign:o?.options?.halign?o.options.halign:d?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})}),!t?.grandTotalSetting?.disableGrandTotal){let o=Number(t?.grandTotalSetting?.colSpan||0),e=Math.min(o+1,y.length),d=p?.grandTotal?.enableCount?m.length>0?i.reduce((a,f)=>a+f.detail.length,0):i.length:0,E=p?.grandTotal?.captionItem||"",c=`${p?.grandTotal?.caption||"GRAND TOTAL"}`+(d?` : ${d}`:"")+(E?` ${E}`:"");for(w[0]={content:c,colSpan:e,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},w.splice(1,e-1);w.length<y.length;)w.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}});r.push(w)}if(typeof t?.addRow=="function"&&t?.addRow(r),!t?.disablePrintDate){let o=M(l);r.push([{content:`Print Date : ${D(`${new Date}`)}`,colSpan:o,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}])}q(g,{head:[],body:r,startY:I,theme:t?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:t?.fontSIze||8},headStyles:{fontSize:t?.fontSIze||8,textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255],didParseCell:function(o){let e=o.column.index;y[e]?.options?.format==="IMAGE"&&o.cell.raw&&o.cell.raw.foto&&(o.row.height=20,o.cell.styles.valign="middle",o.cell.styles.halign="center")},didDrawCell:function(o){let{cell:e}=o,E=(e.raw||{}).foto,c=o.column.index;if(y[c]?.options?.format==="IMAGE"&&E){let C=e.x+(e.width-15)/2,u=e.y+(e.height-15)/2;try{g.addImage(E,"JPG",C,u,15,15)}catch(x){console.warn("\u274C Gagal render gambar:",x)}}}}),r=[],I=g.lastAutoTable.finalY;let A=g.internal.getNumberOfPages(),S=g.internal.pageSize.width,_=g.internal.pageSize.height;g.setFontSize(10);for(let o=1;o<A+1;o++){let e=S/2,d=_-10;g.setPage(o),g.text(`${o} of ${A}`,e,d,{align:"center"})}if(typeof t?.customize=="function"&&t.customize(g,I,q),t?.openNewTab){let o=g.output("bloburl");window.open(o)}else g.save(`${t?.titlePdf||h}.pdf`)},Y=nt;var at=l=>{let i=[],m=l.copy?2:1;for(let t=0;t<m;t++){let n=l.data.map(h=>{let p=l.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(p);)p=p.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(g,r,I)=>{let G=I.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(h[r])?h[r]:[h[r]]).reduce((L,R)=>L+G.replace(/\{([a-z0-9_]+)\}/gm,$=>{let y=$.replace(/(\{|\})/g,"");if(y.match(/nama_barang/)){let w=y.match(/nama_barang/),A=y==="nama_barang2"?[20,40]:y==="nama_barang3"?[40,60]:[0,20];return R[w]?.slice(...A).trim()||""}if(y.match(/deskripsi_jual/)){let w=y.match(/deskripsi_jual/),A=y==="deskripsi_jual2"?[20,40]:y==="deskripsi_jual3"?[40,60]:[0,20];return R[w]?.slice(...A).trim()||""}if(y.match(/deskripsi/)){let w=y.match(/deskripsi/),A=y==="deskripsi2"?[20,40]:y==="deskripsi3"?[40,60]:[0,20];return R[w]?.slice(...A).trim()||""}return R[y]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return p.replace(/\{([a-z0-9_]+)\}/gm,g=>{let r=g.replace(/(\{|\})/g,"");return r.match(/auto_cut/)?`
VA`:h[r]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let h in n)n[h]+=`

`;i.push(...n)}return i},rt=async(l,i)=>{let m=at(l),t=new Blob([m?.join(`
`)||""],{type:"text/plain"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n)},J=rt;var vt=({columns:l,data:i,grouping:m,date:t,type:n,txtSetting:h,pdfSetting:p,excelSetting:g,title:r,footerSetting:I})=>{let G={data:[h?.dataTxt],template:h?.templateTxt,copy:h?.copy};if(i.length===0)throw new Error("Data is required");if(n.length===0)throw new Error("Type is required");if(!K(n))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');n.forEach(F=>{F==="PDF"?Y({pdfSetting:p,date:t,data:i,type:n,columns:l,grouping:m,title:r,footerSetting:I}):F==="TXT"?J(G,h?.titleTxt||""):F==="EXCEL"?V({date:t,data:i,type:n,columns:l,grouping:m,excelSetting:g,title:r,footerSetting:I}):(V({date:t,data:i,type:n,columns:l,grouping:m,excelSetting:g,title:r}),Y({pdfSetting:p,date:t,data:i,type:n,columns:l,grouping:m,title:r}),J(G,h?.titleTxt||""))})};export{vt as ExportData};
//# sourceMappingURL=index.mjs.map