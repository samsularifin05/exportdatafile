var J=["EXCEL","PDF","TXT","ALL"];function F(s,f=!1){let u=new Date(s),t=new Date(u.getTime()+7*60*60*1e3),n=t.getUTCFullYear(),h=String(t.getUTCMonth()+1).padStart(2,"0"),g=String(t.getUTCDate()).padStart(2,"0"),m=String(t.getUTCHours()).padStart(2,"0"),i=String(t.getUTCMinutes()).padStart(2,"0"),R=String(t.getUTCSeconds()).padStart(2,"0");return f?`${g}-${h}-${n} ${m}:${i}:${R}`:`${g}-${h}-${n}`}function K(s){return s.every(f=>J.includes(f))}function M(s){let f=0;return s.forEach(u=>{u.child&&u.child.length>0?f+=M(u.child):f+=1}),f}var P=s=>{let f=[];return s.forEach(u=>{u.child&&u.child.length>0?f.push(...P(u.child)):f.push(u)}),f},B=s=>s.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ");async function O(s,f,u,t){for(let n=0;n<t.length;n++){let h=t[n];if(h?.isImage&&h?.imageSrc&&typeof h.imageSrc=="string"&&h.imageSrc.startsWith("data:image"))try{let{buffer:g,extension:m}=q(h.imageSrc),i=s.addImage({buffer:g,extension:m});f.addImage(i,{tl:{col:n,row:u.number-1},ext:{width:70,height:60},editAs:"oneCell"}),(!u.height||u.height<60)&&(u.height=35)}catch(g){console.error("\u274C Error adding image to row:",g),u.getCell(n+1).value="[Image]"}}}function q(s){let f=s.match(/^data:image\/(\w+);base64,(.*)$/);if(!f)throw new Error("Invalid base64 image format");let u=f[1]==="jpg"?"jpeg":f[1],t=f[2],n=atob(t),h=n.length,g=new Uint8Array(h);for(let m=0;m<h;m++)g[m]=n.charCodeAt(m);return{buffer:g,extension:u}}import Q from"exceljs";var Z=async({columns:s,data:f,grouping:u,date:t,excelSetting:n,title:h,footerSetting:g})=>{let m=new Q.Workbook;s=s.filter(e=>!e.options?.disabledColumn);let i=m.addWorksheet(h||n?.titleExcel),R=M(s),$=i.addRow([]);$.getCell(1).value=h||n?.titleExcel,$.getCell(1).alignment={horizontal:"center"};let z=i.getColumn(R).letter;if(i.mergeCells(`A${$.number}:${z}${$.number}`),$.eachCell(e=>{e.font={color:{argb:"000000"},bold:!0,size:12}}),t){let e=i.addRow([]);e.getCell(1).value=`${t.caption?t.caption:"Tanggal "} : ${t?.start_date} ${t?.end_date?`s/d ${t?.end_date}`:""}`,e.getCell(1).alignment={horizontal:"center"},i.mergeCells(`A${e.number}:${z}${e.number}`),e.eachCell(d=>{d.font={color:{argb:"00000"},bold:!0,size:12}})}let v=i.addRow([]);v.getCell(1).value=n?.additionalTextHeader||"",v.getCell(1).alignment={horizontal:"center"},i.mergeCells(`A${v.number}:${z}${v.number}`),v.eachCell(e=>{e.font={color:{argb:"000000"},bold:!0,size:12}}),n?.customHeader&&n.customHeader(i,R);let L=n?.startY&&n.startY>0?n.startY:1;if(L>1)for(let e=1;e<L;e++)i.addRow([]);let A=s.some(e=>e.child&&e.child.length>0),T=i.addRow([]),b=A?i.addRow([]):null;s.forEach(e=>{if(e.child&&e.child.length>0){let d=T.actualCellCount+1,a=e.child.length;T.getCell(d).value=e.label,a>1&&i.mergeCells(T.number,d,T.number,d+a-1);for(let l=d;l<d+a;l++){let o=T.getCell(l);o.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},o.font={color:{argb:n?.txtColor||"000000"},bold:!0},o.alignment={horizontal:"center",vertical:"middle"}}e.child.forEach((l,o)=>{if(b){let p=b.getCell(d+o);p.value=l.label,p.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},p.font={color:{argb:n?.txtColor||"000000"},bold:!0};let E=l.options?.halign||(["RP","GR","NUMBER"].includes(l?.options?.format||"")?"right":"left"),c=l.options?.valign||"middle";p.alignment={horizontal:E,vertical:c}}})}else{let d=T.actualCellCount+1;T.getCell(d).value=e.label,T.getCell(d).fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"E8E5E5"}},T.getCell(d).font={color:{argb:n?.txtColor||"000000"},bold:!0},T.getCell(d).alignment={horizontal:e.options?.halign||"center",vertical:e.options?.valign||"middle"},A&&b&&i.mergeCells(T.number,d,b.number,d)}}),P(s).forEach((e,d)=>{let a=d+1,l=i.getColumn(a);if(e.options?.width)l.width=e.options.width;else{let o=e.options?.format==="IMAGE"?15:20;l.width=o}});let x={};f.forEach(async e=>{if(e.detail?.length>0){if(u.length>0){let l=M(s),o=u.map(E=>e[E]!==void 0||e[E]!==null?`${B(E)} : ${e[E]}`:"").filter(Boolean).join("  |  "),p=i.addRow([o]);i.mergeCells(`A${p.number}:${String.fromCharCode(64+l)}${p.number}`),p.getCell(1).alignment={horizontal:"left"},p.getCell(1).font={bold:!0}}let d={};e.detail.forEach(async l=>{let p=P(s).map(c=>{if(c?.options?.format==="IMAGE"&&l[c.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:l[c.key]};let I=c?.options?.format==="DATETIME"?F(l[c.key],!0):c?.options?.format==="DATE"?F(l[c.key]):l[c.key],k={horizontal:c?.options?.halign?c?.options?.halign:c?.options?.format==="RP"||c?.options?.format==="GR"||c?.options?.format==="NUMBER"?"right":"left"},G=c.key;return x[G]=(x[G]||0)+Number(I),d[G]=(d[G]||0)+Number(I),{value:I,alignment:k,numFmt:c?.options?.format==="RP"?"#,##0":c?.options?.format==="GR"?"#,##0.000":void 0}}),E=i.addRow(p.map(c=>c.value));p.forEach((c,I)=>{let k=E.getCell(I+1),G=["center","right","left","fill","justify","centerContinuous","distributed"],_=["top","middle","bottom","distributed","justify"],H,S;c.alignment&&typeof c.alignment.horizontal=="string"&&G.includes(c.alignment.horizontal)&&(H=c.alignment.horizontal),c.alignment&&"vertical"in c.alignment&&typeof c.alignment.vertical=="string"&&_.includes(c.alignment.vertical)&&(S=c.alignment.vertical),k.alignment={...H?{horizontal:H}:{},...S?{vertical:S}:{}},c.numFmt&&typeof c.value=="number"&&!isNaN(c.value)&&(k.value=Number(c.value),k.numFmt=c.numFmt)}),await O(m,i,E,p)});let a=P(s);if(!g?.subTotal?.disableSubtotal){let l=i.addRow(s.map(()=>null));a.forEach((o,p)=>{if(o?.options?.format==="RP"||o?.options?.format==="GR"||o?.options?.format==="NUMBER"){let c=f.length+4-1,I=`SUM(${String.fromCharCode(65+p)}4:${String.fromCharCode(65+p)}${c})`,k=l.getCell(p+1),G=g?.subTotal?.enableCount&&u.length>0?" : "+e.detail.length:"",_=g?.subTotal?.captionItem?g?.subTotal?.captionItem:"";l.getCell(1).value=`${g?.subTotal?.caption||"SUB TOTAL"} ${G} ${_}`,l.getCell(1).alignment={horizontal:"center"},k.numFmt=o?.options?.format==="GR"?"#,##0.000":"#,##0",k.value={formula:I},l.getCell(p+1).value=o?.options.disabledFooter?"":d[o.key]}else l.getCell(p+1).value=""}),n?.grandTotalSetting?.colSpan&&i.mergeCells(`A${l.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${l.number}`),l.eachCell(o=>{o.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},o.font={color:{argb:n?.txtColor},bold:!0}})}}else{let a=P(s).map(o=>{if(o?.options?.format==="IMAGE"&&e[o.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:e[o.key]};let p=o?.options?.format==="DATETIME"?F(e[o.key]):o?.options?.format==="DATE"?F(e[o.key]):e[o.key],E={horizontal:o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"||o?.options?.format==="NUMBER"?"right":"left"},c=o.key;return x[c]=(x[c]||0)+Number(p),{value:p,alignment:E,numFmt:o?.options?.format==="RP"?"#,##0":o?.options?.format==="GR"?"#,##0.000":void 0}}),l=i.addRow(a.map(o=>o.value));a.forEach((o,p)=>{let E=l.getCell(p+1),c=["center","right","left","fill","justify","centerContinuous","distributed"],I=["top","middle","bottom","distributed","justify"],k,G;o.alignment&&typeof o.alignment.horizontal=="string"&&c.includes(o.alignment.horizontal)&&(k=o.alignment.horizontal),o.alignment&&"vertical"in o.alignment&&typeof o.alignment.vertical=="string"&&I.includes(o.alignment.vertical)&&(G=o.alignment.vertical),E.alignment={...k?{horizontal:k}:{},...G?{vertical:G}:{}},o.numFmt&&typeof o.value=="number"&&!isNaN(o.value)&&(E.value=Number(o.value),E.numFmt=o.numFmt)}),await O(m,i,l,a)}});let N=i.addRow(s.map(()=>null)),r=P(s);g?.grandTotal?.disableGrandTotal||(r.forEach((e,d)=>{if(e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"){let l=f.length+4-1,o=`SUM(${String.fromCharCode(65+d)}4:${String.fromCharCode(65+d)}${l})`,p=N.getCell(d+1),E=g?.grandTotal?.enableCount?u.length>0?" : "+f.map(k=>k.detail.length).reduce((k,G)=>k+G,0):" : "+f.length:"",c=g?.grandTotal?.captionItem?g?.grandTotal?.captionItem:"",I=`${g?.grandTotal?.caption||"GRAND TOTAL"} ${E} ${c}`;N.getCell(1).value=I,N.getCell(1).alignment={horizontal:"center"},p.numFmt=e?.options?.format==="GR"?"#,##0.000":"#,##0",p.value={formula:o},N.getCell(d+1).value=e?.options.disabledFooter?"":x[e.key]}else N.getCell(d+1).value=""}),n?.grandTotalSetting?.colSpan&&i.mergeCells(`A${N.number}:${String.fromCharCode(64+Number(n?.grandTotalSetting?.colSpan))}${N.number}`),N.eachCell(e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:n?.bgColor||"#E8E5E5"},bgColor:{argb:n?.bgColor||"#E8E5E5"}},e.font={color:{argb:n?.txtColor},bold:!0}})),n?.customFooter&&n.customFooter(i,R);let y=await m.xlsx.writeBuffer(),w=new Blob([y],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),C=document.createElement("a");C.href=URL.createObjectURL(w),C.download=`${n?.titleExcel||h}.xlsx`,document.body.appendChild(C),C.click(),document.body.removeChild(C)},Y=Z;import tt from"jspdf";import W from"jspdf-autotable";var et=({columns:s,data:f,grouping:u,pdfSetting:t,date:n,title:h,footerSetting:g})=>{let m=new tt(t?.orientation,t?.unit,[t?.width||297,t?.height||210]),i=[],R=n?30:20;s=s.filter(r=>!r.options?.disabledColumn),m.setFontSize(10);let $=m.internal.pageSize.getWidth(),z=m.splitTextToSize(t?.textHeaderLeft||"",110);m.text(z,15,18),m.text(`${h||t?.titlePdf}`,$-15,18,{align:"right"}),n&&m.text(`${n.caption?n.caption:"TANGGAL "} : ${n?.start_date} ${n?.end_date?`s/d ${n?.end_date}`:""}`,$-15,22,{align:"right"}),typeof t?.customHeader=="function"&&t.customHeader(m,R,W),m.setProperties({title:h||t?.titlePdf}),t?.startY&&(R=t.startY);let v=[],L=[],A=s.some(r=>r.child&&r.child.length>0);s.forEach(r=>{let y={textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,...r?.options?.width&&{cellWidth:r?.options?.width},fontStyle:"bold",...r?.options?.valign?{valign:r.options.valign}:{},halign:r?.options?.halign??(["RP","GR","NUMBER"].includes(r?.options?.format||"")?"right":"left")};A?r.child&&r.child.length>0?(v.push({content:r.label,colSpan:r.child.length,styles:y}),r.child.forEach(w=>{L.push({content:w.label,key:w.key,options:w.options,styles:{...y,halign:w?.options?.halign??(["RP","GR","NUMBER"].includes(w?.options?.format||"")?"right":"left")}})})):v.push({content:r.label,rowSpan:2,key:r.key,options:r.options,styles:y}):v.push({content:r.label,key:r.key,options:r.options,styles:y})}),i.push(v),A&&L.length>0&&i.push(L);let T={};f.forEach(r=>{if(r.detail?.length>0){if(u.length>0){let C=M(s),d=[{content:u.map(a=>r[a]!==void 0||r[a]!==null?`${B(a)} : ${r[a]}`:"").filter(Boolean).join("  |  "),colSpan:C,styles:{fontStyle:"bold",halign:"left"}}];i.push(d)}let y={},w=P(s);if(r.detail.forEach(C=>{let e=w.map(d=>{let a=C[d.key],l=d.key;T[l]=(T[l]||0)+Number(a||0),y[l]=(y[l]||0)+Number(a||0);let o=d.options?.format==="IMAGE";return{content:(()=>{switch(d?.options?.format){case"RP":return a!==void 0?Number(a||0).toLocaleString("kr-ko"):"";case"GR":return a!==void 0?Number(a||0).toFixed(3):"";case"NUMBER":return a!==void 0?Number(a||0):"";case"IMAGE":return"";case"DATETIME":return a!==void 0?F(a||new Date,!0):"";case"DATE":return a!==void 0?F(a||new Date):"";default:return a!==void 0?a.toString():""}})(),foto:o?a:null,styles:{halign:d?.options?.halign?d?.options?.halign:d?.options?.format==="RP"||d?.options?.format==="GR"||d?.options?.format==="NUMBER"||typeof a=="number"?"right":"left"}}});i.push(e)}),!g?.subTotal?.disableSubtotal){let C=[];w.forEach(l=>{let o=y[l.key];l?.options?.format==="RP"||l?.options?.format==="GR"||l?.options?.format==="NUMBER"?C.push({content:l?.options?.disabledFooter?"":(()=>{switch(l?.options?.format){case"RP":return o.toLocaleString("kr-ko");case"GR":return o.toFixed(3);case"NUMBER":return o;default:return o.toString()}})(),styles:{halign:l?.options?.halign||"right",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}}):C.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let e=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0,d=g?.subTotal?.enableCount&&u.length>0?" : "+r.detail.length:"",a=g?.subTotal?.captionItem?g?.subTotal?.captionItem:"";C[0]={content:`${g?.subTotal?.caption||"SUB TOTAL"}${d} ${a}`,colSpan:e,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&C.splice(1,t?.grandTotalSetting?.colSpan),i.push(C)}}else{let y=(e,d)=>{let a=d[e.key],l=e.key;e.options?.disabledFooter||(T[l]=(T[l]||0)+Number(a||0));let o=(()=>{switch(e?.options?.format){case"RP":return a!==void 0?Number(a||0).toLocaleString("kr-ko"):"";case"GR":return a!==void 0?Number(a||0).toFixed(3):"";case"NUMBER":return a!==void 0?Number(a||0):"";case"IMAGE":return"";case"DATETIME":return a!==void 0?F(a||new Date,!0):"";case"DATE":return a!==void 0?F(a||new Date):"";default:return a!==void 0?a?.toString():""}})(),p=e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"||typeof a=="number"?"right":"left",E=e.options?.format==="IMAGE";return{options:e?.options,content:o,foto:E?a:null,styles:{halign:p}}},C=P(s).map(e=>y(e,r));i.push(C)}});let b=P(s);if(!g?.grandTotal?.disableGrandTotal){let r=[];b.forEach(a=>{let l=T[a.key],o=["RP","GR","NUMBER"].includes(a?.options?.format||""),p=a?.options?.disabledFooter?"":(()=>{if(!o)return"";switch(a.options?.format){case"RP":return Number(l||0).toLocaleString("kr-KO");case"GR":return Number(l||0).toFixed(3);case"NUMBER":return Number(l||0);default:return(l||0).toString()}})();r.push({options:a?.options,content:p,styles:{halign:a?.options?.halign?a.options.halign:o?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let y=Number(t?.grandTotalSetting?.colSpan||0),w=Math.min(y+1,b.length),C=g?.grandTotal?.enableCount?u.length>0?f.reduce((a,l)=>a+l.detail.length,0):f.length:0,e=g?.grandTotal?.captionItem||"",d=`${g?.grandTotal?.caption||"GRAND TOTAL"}`+(C?` : ${C}`:"")+(e?` ${e}`:"");for(r[0]={content:d,colSpan:w,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},r.splice(1,w-1);r.length<b.length;)r.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}});i.push(r)}if(typeof t?.addRow=="function"&&t?.addRow(i),!t?.disablePrintDate){let r=M(s);i.push([{content:`Print Date : ${F(`${new Date}`)}`,colSpan:r,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}])}W(m,{head:[],body:i,startY:R,theme:t?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:t?.fontSIze||8},headStyles:{fontSize:t?.fontSIze||8,textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255],didParseCell:function(r){let y=r.column.index;b[y]?.options?.format==="IMAGE"&&r.cell.raw&&r.cell.raw.foto&&(r.row.height=20,r.cell.styles.valign="middle",r.cell.styles.halign="center")},didDrawCell:function(r){let{cell:y}=r,C=(y.raw||{}).foto,e=r.column.index;if(b[e]?.options?.format==="IMAGE"&&C){let l=y.x+(y.width-15)/2,o=y.y+(y.height-15)/2;try{m.addImage(C,"JPG",l,o,15,15)}catch(p){console.warn("\u274C Gagal render gambar:",p)}}}}),i=[],R=m.lastAutoTable.finalY;let D=m.internal.getNumberOfPages(),x=m.internal.pageSize.width,N=m.internal.pageSize.height;m.setFontSize(10);for(let r=1;r<D+1;r++){let y=x/2,w=N-10;m.setPage(r),m.text(`${r} of ${D}`,y,w,{align:"center"})}if(typeof t?.customFooter=="function"&&t.customFooter(m,R,W),t?.openNewTab){let r=m.output("bloburl");window.open(r)}else m.save(`${t?.titlePdf||h}.pdf`)},X=et;var ot=s=>{let f=[],u=s.copy?2:1;for(let t=0;t<u;t++){let n=s.data.map(h=>{let g=s.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(g);)g=g.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(m,i,R)=>{let $=R.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(h[i])?h[i]:[h[i]]).reduce((L,A)=>L+$.replace(/\{([a-z0-9_]+)\}/gm,T=>{let b=T.replace(/(\{|\})/g,"");if(b.match(/nama_barang/)){let D=b.match(/nama_barang/),x=b==="nama_barang2"?[20,40]:b==="nama_barang3"?[40,60]:[0,20];return A[D]?.slice(...x).trim()||""}if(b.match(/deskripsi_jual/)){let D=b.match(/deskripsi_jual/),x=b==="deskripsi_jual2"?[20,40]:b==="deskripsi_jual3"?[40,60]:[0,20];return A[D]?.slice(...x).trim()||""}if(b.match(/deskripsi/)){let D=b.match(/deskripsi/),x=b==="deskripsi2"?[20,40]:b==="deskripsi3"?[40,60]:[0,20];return A[D]?.slice(...x).trim()||""}return A[b]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return g.replace(/\{([a-z0-9_]+)\}/gm,m=>{let i=m.replace(/(\{|\})/g,"");return i.match(/auto_cut/)?`
VA`:h[i]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let h in n)n[h]+=`

`;f.push(...n)}return f},nt=async(s,f)=>{let u=ot(s),t=new Blob([u?.join(`
`)||""],{type:"text/plain"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=f,document.body.appendChild(n),n.click(),document.body.removeChild(n)},V=nt;var $t=({columns:s,data:f,grouping:u,date:t,type:n,txtSetting:h,pdfSetting:g,excelSetting:m,title:i,footerSetting:R})=>{let $={data:[h?.dataTxt],template:h?.templateTxt,copy:h?.copy};if(f.length===0)throw new Error("Data is required");if(n.length===0)throw new Error("Type is required");if(!K(n))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');n.forEach(z=>{z==="PDF"?X({pdfSetting:g,date:t,data:f,type:n,columns:s,grouping:u,title:i,footerSetting:R}):z==="TXT"?V($,h?.titleTxt||""):z==="EXCEL"?Y({date:t,data:f,type:n,columns:s,grouping:u,excelSetting:m,title:i,footerSetting:R}):(Y({date:t,data:f,type:n,columns:s,grouping:u,excelSetting:m,title:i}),X({pdfSetting:g,date:t,data:f,type:n,columns:s,grouping:u,title:i}),V($,h?.titleTxt||""))})};export{$t as ExportData};
//# sourceMappingURL=index.mjs.map