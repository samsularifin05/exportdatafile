var J=["EXCEL","PDF","TXT","ALL"];function A(s){let d=new Date(s),u=d.getFullYear(),o=String(d.getMonth()+1).padStart(2,"0"),a=String(d.getDate()).padStart(2,"0"),p=String(d.getHours()).padStart(2,"0"),g=String(d.getMinutes()).padStart(2,"0"),f=String(d.getSeconds()).padStart(2,"0");return`${a}-${o}-${u} ${p}:${g}:${f}`}function W(s){return s.every(d=>J.includes(d))}function L(s){let d=0;return s.forEach(u=>{u.child&&u.child.length>0?d+=L(u.child):d+=1}),d}var z=s=>{let d=[];return s.forEach(u=>{u.child&&u.child.length>0?d.push(...z(u.child)):d.push(u)}),d},U=s=>s.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");async function S(s,d,u,o){for(let a=0;a<o.length;a++){let p=o[a];if(p?.isImage&&p?.imageSrc&&typeof p.imageSrc=="string"&&p.imageSrc.startsWith("data:image"))try{let{buffer:g,extension:f}=K(p.imageSrc),l=s.addImage({buffer:g,extension:f});d.addImage(l,{tl:{col:a,row:u.number-1},ext:{width:70,height:60},editAs:"oneCell"}),(!u.height||u.height<60)&&(u.height=35)}catch(g){console.error("\u274C Error adding image to row:",g),u.getCell(a+1).value="[Image]"}}}function K(s){let d=s.match(/^data:image\/(\w+);base64,(.*)$/);if(!d)throw new Error("Invalid base64 image format");let u=d[1]==="jpg"?"jpeg":d[1],o=d[2],a=atob(o),p=a.length,g=new Uint8Array(p);for(let f=0;f<p;f++)g[f]=a.charCodeAt(f);return{buffer:g,extension:u}}import q from"exceljs";var Q=async({columns:s,data:d,grouping:u,date:o,excelSetting:a,title:p,footerSetting:g})=>{let f=new q.Workbook;s=s.filter(n=>!n.options?.disabledColumn);let l=f.addWorksheet(p||a?.titleExcel),k=L(s),$=l.addRow([]);$.getCell(1).value=p||a?.titleExcel,$.getCell(1).alignment={horizontal:"center"};let I=l.getColumn(k).letter;if(l.mergeCells(`A${$.number}:${I}${$.number}`),$.eachCell(n=>{n.font={color:{argb:"000000"},bold:!0,size:12}}),o){let n=l.addRow([]);n.getCell(1).value=`${o.caption?o.caption:"Tanggal "} : ${o?.start_date} ${o?.end_date?`s/d ${o?.end_date}`:""}`,n.getCell(1).alignment={horizontal:"center"},l.mergeCells(`A${n.number}:${I}${n.number}`),n.eachCell(i=>{i.font={color:{argb:"00000"},bold:!0,size:12}})}let v=l.addRow([]);v.getCell(1).value=a?.additionalTextHeader||"",v.getCell(1).alignment={horizontal:"center"},l.mergeCells(`A${v.number}:${I}${v.number}`),v.eachCell(n=>{n.font={color:{argb:"000000"},bold:!0,size:12}}),a?.customHeader&&a.customHeader(l,k);let N=a?.startY&&a.startY>0?a.startY:1;if(N>1)for(let n=1;n<N;n++)l.addRow([]);let P=s.some(n=>n.child&&n.child.length>0),T=l.addRow([]),h=P?l.addRow([]):null;s.forEach(n=>{if(n.child&&n.child.length>0){let i=T.actualCellCount+1,b=n.child.length;T.getCell(i).value=n.label,b>1&&l.mergeCells(T.number,i,T.number,i+b-1);for(let e=i;e<i+b;e++){let t=T.getCell(e);t.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"E8E5E5"}},t.font={color:{argb:a?.txtColor||"000000"},bold:!0},t.alignment={horizontal:"center",vertical:"middle"}}n.child.forEach((e,t)=>{if(h){let m=h.getCell(i+t);m.value=e.label,m.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"E8E5E5"}},m.font={color:{argb:a?.txtColor||"000000"},bold:!0};let C=e.options?.halign||(["RP","GR","NUMBER"].includes(e?.options?.format||"")?"right":"left"),c=e.options?.valign||"middle";m.alignment={horizontal:C,vertical:c}}})}else{let i=T.actualCellCount+1;T.getCell(i).value=n.label,T.getCell(i).fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"E8E5E5"}},T.getCell(i).font={color:{argb:a?.txtColor||"000000"},bold:!0},T.getCell(i).alignment={horizontal:n.options?.halign||"center",vertical:n.options?.valign||"middle"},P&&h&&l.mergeCells(T.number,i,h.number,i)}});let G={};d.forEach(async n=>{if(n.detail?.length>0){if(u.length>0){let e=L(s),t=u.map(C=>n[C]!==void 0||n[C]!==null?`${U(C)} : ${n[C]}`:"").filter(Boolean).join("  |  "),m=l.addRow([t]);l.mergeCells(`A${m.number}:${String.fromCharCode(64+e)}${m.number}`),m.getCell(1).alignment={horizontal:"left"},m.getCell(1).font={bold:!0}}let i={};n.detail.forEach(async e=>{let m=z(s).map(c=>{if(c?.options?.format==="IMAGE"&&e[c.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:e[c.key]};let F=c?.options?.format==="DATETIME"?A(e[c.key]):e[c.key],R={horizontal:c?.options?.halign?c?.options?.halign:c?.options?.format==="RP"||c?.options?.format==="GR"||c?.options?.format==="NUMBER"?"right":"left"},x=c.key;return G[x]=(G[x]||0)+Number(F),i[x]=(i[x]||0)+Number(F),{value:F,alignment:R,numFmt:c?.options?.format==="RP"?"#,##0":c?.options?.format==="GR"?"#,##0.000":void 0}}),C=l.addRow(m.map(c=>c.value));m.forEach((c,F)=>{let R=C.getCell(F+1),x=["center","right","left","fill","justify","centerContinuous","distributed"],B=["top","middle","bottom","distributed","justify"],_,H;c.alignment&&typeof c.alignment.horizontal=="string"&&x.includes(c.alignment.horizontal)&&(_=c.alignment.horizontal),c.alignment&&"vertical"in c.alignment&&typeof c.alignment.vertical=="string"&&B.includes(c.alignment.vertical)&&(H=c.alignment.vertical),R.alignment={..._?{horizontal:_}:{},...H?{vertical:H}:{}},c.numFmt&&typeof c.value=="number"&&!isNaN(c.value)&&(R.value=Number(c.value),R.numFmt=c.numFmt)}),await S(f,l,C,m)});let b=z(s);if(!g?.subTotal?.disableSubtotal){let e=l.addRow(s.map(()=>null));b.forEach((t,m)=>{if(t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"){let c=d.length+4-1,F=`SUM(${String.fromCharCode(65+m)}4:${String.fromCharCode(65+m)}${c})`,R=e.getCell(m+1),x=g?.subTotal?.enableCount&&u.length>0?" : "+n.detail.length:"",B=g?.subTotal?.captionItem?g?.subTotal?.captionItem:"";e.getCell(1).value=`${g?.subTotal?.caption||"SUB TOTAL"} ${x} ${B}`,e.getCell(1).alignment={horizontal:"center"},R.numFmt=t?.options?.format==="GR"?"#,##0.000":"#,##0",R.value={formula:F},e.getCell(m+1).value=t?.options.disabledFooter?"":i[t.key]}else e.getCell(m+1).value=""}),a?.grandTotalSetting?.colSpan&&l.mergeCells(`A${e.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${e.number}`),e.eachCell(t=>{t.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},t.font={color:{argb:a?.txtColor},bold:!0}})}}else{let b=z(s).map(t=>{if(t?.options?.format==="IMAGE"&&n[t.key])return{value:"",alignment:{horizontal:"center",vertical:"middle"},isImage:!0,imageSrc:n[t.key]};let m=t?.options?.format==="DATETIME"?A(n[t.key]):n[t.key],C={horizontal:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"},c=t.key;return G[c]=(G[c]||0)+Number(m),{value:m,alignment:C,numFmt:t?.options?.format==="RP"?"#,##0":t?.options?.format==="GR"?"#,##0.000":void 0}}),e=l.addRow(b.map(t=>t.value));b.forEach((t,m)=>{let C=e.getCell(m+1),c=["center","right","left","fill","justify","centerContinuous","distributed"],F=["top","middle","bottom","distributed","justify"],R,x;t.alignment&&typeof t.alignment.horizontal=="string"&&c.includes(t.alignment.horizontal)&&(R=t.alignment.horizontal),t.alignment&&"vertical"in t.alignment&&typeof t.alignment.vertical=="string"&&F.includes(t.alignment.vertical)&&(x=t.alignment.vertical),C.alignment={...R?{horizontal:R}:{},...x?{vertical:x}:{}},t.numFmt&&typeof t.value=="number"&&!isNaN(t.value)&&(C.value=Number(t.value),C.numFmt=t.numFmt)}),await S(f,l,e,b)}});let w=l.addRow(s.map(()=>null)),j=z(s);g?.grandTotal?.disableGrandTotal||(j.forEach((n,i)=>{if(n?.options?.format==="RP"||n?.options?.format==="GR"||n?.options?.format==="NUMBER"){let e=d.length+4-1,t=`SUM(${String.fromCharCode(65+i)}4:${String.fromCharCode(65+i)}${e})`,m=w.getCell(i+1),C=g?.grandTotal?.enableCount?u.length>0?" : "+d.map(R=>R.detail.length).reduce((R,x)=>R+x,0):" : "+d.length:"",c=g?.grandTotal?.captionItem?g?.grandTotal?.captionItem:"",F=`${g?.grandTotal?.caption||"GRAND TOTAL"} ${C} ${c}`;w.getCell(1).value=F,w.getCell(1).alignment={horizontal:"center"},m.numFmt=n?.options?.format==="GR"?"#,##0.000":"#,##0",m.value={formula:t},w.getCell(i+1).value=n?.options.disabledFooter?"":G[n.key]}else w.getCell(i+1).value=""}),a?.grandTotalSetting?.colSpan&&l.mergeCells(`A${w.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${w.number}`),w.eachCell(n=>{n.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},n.font={color:{argb:a?.txtColor},bold:!0}})),a?.customFooter&&a.customFooter(l,k);let r=await f.xlsx.writeBuffer(),y=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),E=document.createElement("a");E.href=URL.createObjectURL(y),E.download=`${a?.titleExcel||p}.xlsx`,document.body.appendChild(E),E.click(),document.body.removeChild(E)},O=Q;import Z from"jspdf";import Y from"jspdf-autotable";var tt=({columns:s,data:d,grouping:u,pdfSetting:o,date:a,title:p,footerSetting:g})=>{let f=new Z(o?.orientation,o?.unit,[o?.width||297,o?.height||210]),l=[],k=a?30:20;s=s.filter(r=>!r.options?.disabledColumn),f.setFontSize(10);let $=f.internal.pageSize.getWidth(),I=f.splitTextToSize(o?.textHeaderLeft||"",110);f.text(I,15,18),f.text(`${p||o?.titlePdf}`,$-15,18,{align:"right"}),a&&f.text(`${a.caption?a.caption:"TANGGAL "} : ${a?.start_date} ${a?.end_date?`s/d ${a?.end_date}`:""}`,$-15,22,{align:"right"}),typeof o?.customHeader=="function"&&o.customHeader(f,k,Y),f.setProperties({title:p||o?.titlePdf}),o?.startY&&(k=o.startY);let v=[],N=[],P=s.some(r=>r.child&&r.child.length>0);s.forEach(r=>{let y={textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",...r?.options?.valign?{valign:r.options.valign}:{},halign:r?.options?.halign??(["RP","GR","NUMBER"].includes(r?.options?.format||"")?"right":"left")};P?r.child&&r.child.length>0?(v.push({content:r.label,colSpan:r.child.length,styles:y}),r.child.forEach(E=>{N.push({content:E.label,key:E.key,options:E.options,styles:{...y,halign:E?.options?.halign??(["RP","GR","NUMBER"].includes(E?.options?.format||"")?"right":"left")}})})):v.push({content:r.label,rowSpan:2,key:r.key,options:r.options,styles:y}):v.push({content:r.label,key:r.key,options:r.options,styles:y})}),l.push(v),P&&N.length>0&&l.push(N);let T={};d.forEach(r=>{if(r.detail?.length>0){if(u.length>0){let n=L(s),b=[{content:u.map(e=>r[e]!==void 0||r[e]!==null?`${U(e)} : ${r[e]}`:"").filter(Boolean).join("  |  "),colSpan:n,styles:{fontStyle:"bold",halign:"left"}}];l.push(b)}let y={},E=z(s);if(r.detail.forEach(n=>{let i=E.map(b=>{let e=n[b.key],t=b.key;T[t]=(T[t]||0)+Number(e||0),y[t]=(y[t]||0)+Number(e||0);let m=b.options?.format==="IMAGE";return{content:(()=>{switch(b?.options?.format){case"RP":return e!==void 0?Number(e||0).toLocaleString("kr-ko"):"";case"GR":return e!==void 0?Number(e||0).toFixed(3):"";case"NUMBER":return e!==void 0?Number(e||0):"";case"IMAGE":return"";case"DATETIME":return e!==void 0?A(e||new Date):"";default:return e!==void 0?e.toString():""}})(),foto:m?e:null,styles:{halign:b?.options?.halign?b?.options?.halign:b?.options?.format==="RP"||b?.options?.format==="GR"||b?.options?.format==="NUMBER"||typeof e=="number"?"right":"left"}}});l.push(i)}),!g?.subTotal?.disableSubtotal){let n=[];E.forEach(t=>{let m=y[t.key];t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?n.push({content:t?.options?.disabledFooter?"":(()=>{switch(t?.options?.format){case"RP":return m.toLocaleString("kr-ko");case"GR":return m.toFixed(3);case"NUMBER":return m;default:return m.toString()}})(),styles:{halign:t?.options?.halign||"right",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}}):n.push({content:"",styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let i=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0,b=g?.subTotal?.enableCount&&u.length>0?" : "+r.detail.length:"",e=g?.subTotal?.captionItem?g?.subTotal?.captionItem:"";n[0]={content:`${g?.subTotal?.caption||"SUB TOTAL"}${b} ${e}`,colSpan:i,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&n.splice(1,o?.grandTotalSetting?.colSpan),l.push(n)}}else{let y=(i,b)=>{let e=b[i.key],t=i.key;i.options?.disabledFooter||(T[t]=(T[t]||0)+Number(e||0));let m=(()=>{switch(i?.options?.format){case"RP":return e!==void 0?Number(e||0).toLocaleString("kr-ko"):"";case"GR":return e!==void 0?Number(e||0).toFixed(3):"";case"NUMBER":return e!==void 0?Number(e||0):"";case"IMAGE":return"";case"DATETIME":return e!==void 0?A(e||new Date):"";default:return e!==void 0?e?.toString():""}})(),C=i?.options?.halign?i?.options?.halign:i?.options?.format==="RP"||i?.options?.format==="GR"||i?.options?.format==="NUMBER"||typeof e=="number"?"right":"left",c=i.options?.format==="IMAGE";return{options:i?.options,content:m,foto:c?e:null,styles:{halign:C}}},n=z(s).map(i=>y(i,r));l.push(n)}});let h=z(s);if(!g?.grandTotal?.disableGrandTotal){let r=[];h.forEach(e=>{let t=T[e.key],m=["RP","GR","NUMBER"].includes(e?.options?.format||""),C=e?.options?.disabledFooter?"":(()=>{if(!m)return"";switch(e.options?.format){case"RP":return Number(t||0).toLocaleString("kr-KO");case"GR":return Number(t||0).toFixed(3);case"NUMBER":return Number(t||0);default:return(t||0).toString()}})();r.push({options:e?.options,content:C,styles:{halign:e?.options?.halign?e.options.halign:m?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let y=Number(o?.grandTotalSetting?.colSpan||0),E=Math.min(y+1,h.length),n=g?.grandTotal?.enableCount?u.length>0?d.reduce((e,t)=>e+t.detail.length,0):d.length:0,i=g?.grandTotal?.captionItem||"",b=`${g?.grandTotal?.caption||"GRAND TOTAL"}`+(n?` : ${n}`:"")+(i?` ${i}`:"");for(r[0]={content:b,colSpan:E,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},r.splice(1,E-1);r.length<h.length;)r.push({content:"",styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}});l.push(r)}if(typeof o?.addRow=="function"&&o?.addRow(l),!o?.disablePrintDate){let r=L(s);l.push([{content:`Print Date : ${A(`${new Date}`)}`,colSpan:r,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}])}Y(f,{head:[],body:l,startY:k,theme:o?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:o?.fontSIze||8},headStyles:{fontSize:o?.fontSIze||8,textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255],didParseCell:function(r){let y=r.column.index;h[y]?.options?.format==="IMAGE"&&r.cell.raw&&r.cell.raw.foto&&(r.row.height=20,r.cell.styles.valign="middle",r.cell.styles.halign="center")},didDrawCell:function(r){let{cell:y}=r,n=(y.raw||{}).foto,i=r.column.index;if(h[i]?.options?.format==="IMAGE"&&n){let t=y.x+(y.width-15)/2,m=y.y+(y.height-15)/2;try{f.addImage(n,"JPG",t,m,15,15)}catch(C){console.warn("\u274C Gagal render gambar:",C)}}}}),l=[],k=f.lastAutoTable.finalY;let G=f.internal.getNumberOfPages(),w=f.internal.pageSize.width,j=f.internal.pageSize.height;f.setFontSize(10);for(let r=1;r<G+1;r++){let y=w/2,E=j-10;f.setPage(r),f.text(`${r} of ${G}`,y,E,{align:"center"})}if(typeof o?.customFooter=="function"&&o.customFooter(f,k,Y),o?.openNewTab){let r=f.output("bloburl");window.open(r)}else f.save(`${o?.titlePdf||p}.pdf`)},X=tt;var et=s=>{let d=[],u=s.copy?2:1;for(let o=0;o<u;o++){let a=s.data.map(p=>{let g=s.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(g);)g=g.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(f,l,k)=>{let $=k.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(p[l])?p[l]:[p[l]]).reduce((N,P)=>N+$.replace(/\{([a-z0-9_]+)\}/gm,T=>{let h=T.replace(/(\{|\})/g,"");if(h.match(/nama_barang/)){let G=h.match(/nama_barang/),w=h==="nama_barang2"?[20,40]:h==="nama_barang3"?[40,60]:[0,20];return P[G]?.slice(...w).trim()||""}if(h.match(/deskripsi_jual/)){let G=h.match(/deskripsi_jual/),w=h==="deskripsi_jual2"?[20,40]:h==="deskripsi_jual3"?[40,60]:[0,20];return P[G]?.slice(...w).trim()||""}if(h.match(/deskripsi/)){let G=h.match(/deskripsi/),w=h==="deskripsi2"?[20,40]:h==="deskripsi3"?[40,60]:[0,20];return P[G]?.slice(...w).trim()||""}return P[h]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return g.replace(/\{([a-z0-9_]+)\}/gm,f=>{let l=f.replace(/(\{|\})/g,"");return l.match(/auto_cut/)?`
VA`:p[l]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let p in a)a[p]+=`

`;d.push(...a)}return d},ot=async(s,d)=>{let u=et(s),o=new Blob([u?.join(`
`)||""],{type:"text/plain"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=d,document.body.appendChild(a),a.click(),document.body.removeChild(a)},V=ot;var Gt=({columns:s,data:d,grouping:u,date:o,type:a,txtSetting:p,pdfSetting:g,excelSetting:f,title:l,footerSetting:k})=>{let $={data:[p?.dataTxt],template:p?.templateTxt,copy:p?.copy};if(d.length===0)throw new Error("Data is required");if(a.length===0)throw new Error("Type is required");if(!W(a))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');a.forEach(I=>{I==="PDF"?X({pdfSetting:g,date:o,data:d,type:a,columns:s,grouping:u,title:l,footerSetting:k}):I==="TXT"?V($,p?.titleTxt||""):I==="EXCEL"?O({date:o,data:d,type:a,columns:s,grouping:u,excelSetting:f,title:l,footerSetting:k}):(O({date:o,data:d,type:a,columns:s,grouping:u,excelSetting:f,title:l}),X({pdfSetting:g,date:o,data:d,type:a,columns:s,grouping:u,title:l}),V($,p?.titleTxt||""))})};export{Gt as ExportData};
//# sourceMappingURL=index.mjs.map